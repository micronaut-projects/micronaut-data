<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut Data</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()"><div style="background-color: color(display-p3 1 0.784 0.2);border-top: 1px solid #000;z-index: 999;font-weight: bold;position:fixed;bottom: 0;left: 0;width: 100%;height: 42px;font-family: -apple-system, 'Helvetica Neue', Helvetica, sans-serif;font-size: 25px;text-align:center;padding-top: 15px;">The documentation you are viewing is not the latest documentation of <a style="color: #fff !important;" href="https://micronaut-projects.github.io/micronaut-data/latest/guide/index.html">Micronaut Data</a></div>



<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#buildConfig"><strong>3</strong><span>Build Configuration</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repositories"><strong>4</strong><span>Repository Interfaces</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#querying"><strong>5</strong><span>Writing Queries</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#dataUpdates"><strong>6</strong><span>Updating Data</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#howItWorks"><strong>7</strong><span>How Micronaut Data Works</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#sql"><strong>8</strong><span>Micronaut Data with SQL</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#graal"><strong>9</strong><span>Going Native with GraalVM</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#spring"><strong>10</strong><span>Spring Data Support</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>1.1</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-quickStart"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-buildConfig"><a href="#buildConfig"><strong>3</strong><span>Build Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repositories"><a href="#repositories"><strong>4</strong><span>Repository Interfaces</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-querying"><a href="#querying"><strong>5</strong><span>Writing Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-criteria"><a href="#criteria"><strong>5.1</strong><span>Query Criteria</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-pagination"><a href="#pagination"><strong>5.2</strong><span>Pagination</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-ordering"><a href="#ordering"><strong>5.3</strong><span>Ordering</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-projections"><a href="#projections"><strong>5.4</strong><span>Query Projections</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-dto"><a href="#dto"><strong>5.5</strong><span>DTO Projections</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-joinQueries"><a href="#joinQueries"><strong>5.6</strong><span>Join Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-explicitQueries"><a href="#explicitQueries"><strong>5.7</strong><span>Explicit Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-whereAnnotation"><a href="#whereAnnotation"><strong>5.8</strong><span>Modifying Queries with @Where</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-nativeQueries"><a href="#nativeQueries"><strong>5.9</strong><span>Native Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-async"><a href="#async"><strong>5.10</strong><span>Asynchronous Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reactive"><a href="#reactive"><strong>5.11</strong><span>Reactive Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-dataUpdates"><a href="#dataUpdates"><strong>6</strong><span>Updating Data</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-transactions"><a href="#transactions"><strong>6.1</strong><span>Transactions</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-programmaticTransactions"><a href="#programmaticTransactions"><strong>6.1.1</strong><span>Programmatic Transactions</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-transactionalEvents"><a href="#transactionalEvents"><strong>6.1.2</strong><span>Transactional Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-batchUpdates"><a href="#batchUpdates"><strong>6.2</strong><span>Batch Updates</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-batchDeletes"><a href="#batchDeletes"><strong>6.3</strong><span>Batch Deletes</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-timestamps"><a href="#timestamps"><strong>6.4</strong><span>Entity Timestamps</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-howItWorks"><a href="#howItWorks"><strong>7</strong><span>How Micronaut Data Works</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-sql"><a href="#sql"><strong>8</strong><span>Micronaut Data with SQL</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jdbc"><a href="#jdbc"><strong>8.1</strong><span>Micronaut Data JDBC</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jdbcQuickStart"><a href="#jdbcQuickStart"><strong>8.1.1</strong><span>JDBC Quick Start</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jdbcConfiguration"><a href="#jdbcConfiguration"><strong>8.1.2</strong><span>JDBC Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jdbcRepositories"><a href="#jdbcRepositories"><strong>8.1.3</strong><span>JDBC Repositories</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlInserts"><a href="#sqlInserts"><strong>8.1.3.1</strong><span>Inserts and Updates</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-sqlMapping"><a href="#sqlMapping"><strong>8.1.4</strong><span>Mapping Entities</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlAnnotations"><a href="#sqlAnnotations"><strong>8.1.4.1</strong><span>SQL Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlIdGenerator"><a href="#sqlIdGenerator"><strong>8.1.4.2</strong><span>ID Generation</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlCompositeId"><a href="#sqlCompositeId"><strong>8.1.4.3</strong><span>Composite Primary Keys</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlConstructorArguments"><a href="#sqlConstructorArguments"><strong>8.1.4.4</strong><span>Constructor Arguments</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlNaming"><a href="#sqlNaming"><strong>8.1.4.5</strong><span>SQL Naming Strategies</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlAssociations"><a href="#sqlAssociations"><strong>8.1.4.6</strong><span>Association Fetching</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-columnTransformer"><a href="#columnTransformer"><strong>8.1.4.7</strong><span>Using @ColumnTransformer</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-sqlJsonType"><a href="#sqlJsonType"><strong>8.1.4.8</strong><span>JSON Column Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jdbcJoinQueries"><a href="#jdbcJoinQueries"><strong>8.1.5</strong><span>JDBC Join Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jdbcDataTypes"><a href="#jdbcDataTypes"><strong>8.1.6</strong><span>JDBC Data Types</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jdbcNativeQueries"><a href="#jdbcNativeQueries"><strong>8.1.7</strong><span>Explicit JDBC Queries</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-graal"><a href="#graal"><strong>9</strong><span>Going Native with GraalVM</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-spring"><a href="#spring"><strong>10</strong><span>Spring Data Support</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut Data</h1>
        <p></p>
        <p>Data Repository Support for Micronaut</p>
        <p><strong>Version:</strong> <select style='max-width: 200px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option value='https://micronaut-projects.github.io/micronaut-data/latest/guide/index.html'>LATEST</option><option value='https://micronaut-projects.github.io/micronaut-data/snapshot/guide/index.html'>SNAPSHOT</option><option value='https://micronaut-projects.github.io/micronaut-data/4.5.0/guide/index.html'>4.5.0</option><option value='https://micronaut-projects.github.io/micronaut-data/4.4.1/guide/index.html'>4.4.1</option><option value='https://micronaut-projects.github.io/micronaut-data/4.4.0/guide/index.html'>4.4.0</option><option value='https://micronaut-projects.github.io/micronaut-data/4.3.1/guide/index.html'>4.3.1</option><option value='https://micronaut-projects.github.io/micronaut-data/4.3.0/guide/index.html'>4.3.0</option><option value='https://micronaut-projects.github.io/micronaut-data/4.2.0/guide/index.html'>4.2.0</option><option value='https://micronaut-projects.github.io/micronaut-data/4.1.4/guide/index.html'>4.1.4</option><option value='https://micronaut-projects.github.io/micronaut-data/4.1.3/guide/index.html'>4.1.3</option><option value='https://micronaut-projects.github.io/micronaut-data/4.1.2/guide/index.html'>4.1.2</option><option value='https://micronaut-projects.github.io/micronaut-data/4.1.1/guide/index.html'>4.1.1</option><option value='https://micronaut-projects.github.io/micronaut-data/4.1.0/guide/index.html'>4.1.0</option><option value='https://micronaut-projects.github.io/micronaut-data/4.0.4/guide/index.html'>4.0.4</option><option value='https://micronaut-projects.github.io/micronaut-data/4.0.3/guide/index.html'>4.0.3</option><option value='https://micronaut-projects.github.io/micronaut-data/4.0.2/guide/index.html'>4.0.2</option><option value='https://micronaut-projects.github.io/micronaut-data/4.0.1/guide/index.html'>4.0.1</option><option value='https://micronaut-projects.github.io/micronaut-data/4.0.0/guide/index.html'>4.0.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.10.0/guide/index.html'>3.10.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.7/guide/index.html'>3.9.7</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.6/guide/index.html'>3.9.6</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.5/guide/index.html'>3.9.5</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.4/guide/index.html'>3.9.4</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.3/guide/index.html'>3.9.3</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.1/guide/index.html'>3.9.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.9.0/guide/index.html'>3.9.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.8.1/guide/index.html'>3.8.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.8.0/guide/index.html'>3.8.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.7.5/guide/index.html'>3.7.5</option><option value='https://micronaut-projects.github.io/micronaut-data/3.7.4/guide/index.html'>3.7.4</option><option value='https://micronaut-projects.github.io/micronaut-data/3.7.3/guide/index.html'>3.7.3</option><option value='https://micronaut-projects.github.io/micronaut-data/3.7.2/guide/index.html'>3.7.2</option><option value='https://micronaut-projects.github.io/micronaut-data/3.7.1/guide/index.html'>3.7.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.7.0/guide/index.html'>3.7.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.5.0/guide/index.html'>3.5.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.4.3/guide/index.html'>3.4.3</option><option value='https://micronaut-projects.github.io/micronaut-data/3.4.2/guide/index.html'>3.4.2</option><option value='https://micronaut-projects.github.io/micronaut-data/3.4.1/guide/index.html'>3.4.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.4.0/guide/index.html'>3.4.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.3.0/guide/index.html'>3.3.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.2.2/guide/index.html'>3.2.2</option><option value='https://micronaut-projects.github.io/micronaut-data/3.2.1/guide/index.html'>3.2.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.2.0/guide/index.html'>3.2.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.1.2/guide/index.html'>3.1.2</option><option value='https://micronaut-projects.github.io/micronaut-data/3.1.1/guide/index.html'>3.1.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.1.0/guide/index.html'>3.1.0</option><option value='https://micronaut-projects.github.io/micronaut-data/3.0.1/guide/index.html'>3.0.1</option><option value='https://micronaut-projects.github.io/micronaut-data/3.0.0/guide/index.html'>3.0.0</option><option value='https://micronaut-projects.github.io/micronaut-data/2.5.0/guide/index.html'>2.5.0</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.7/guide/index.html'>2.4.7</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.6/guide/index.html'>2.4.6</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.5/guide/index.html'>2.4.5</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.4/guide/index.html'>2.4.4</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.3/guide/index.html'>2.4.3</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.2/guide/index.html'>2.4.2</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.1/guide/index.html'>2.4.1</option><option value='https://micronaut-projects.github.io/micronaut-data/2.4.0/guide/index.html'>2.4.0</option><option value='https://micronaut-projects.github.io/micronaut-data/2.3.1/guide/index.html'>2.3.1</option><option value='https://micronaut-projects.github.io/micronaut-data/2.3.0/guide/index.html'>2.3.0</option><option value='https://micronaut-projects.github.io/micronaut-data/2.2.4/guide/index.html'>2.2.4</option><option value='https://micronaut-projects.github.io/micronaut-data/2.2.3/guide/index.html'>2.2.3</option><option value='https://micronaut-projects.github.io/micronaut-data/2.2.2/guide/index.html'>2.2.2</option><option value='https://micronaut-projects.github.io/micronaut-data/2.2.1/guide/index.html'>2.2.1</option><option value='https://micronaut-projects.github.io/micronaut-data/2.2.0/guide/index.html'>2.2.0</option><option value='https://micronaut-projects.github.io/micronaut-data/2.1.1/guide/index.html'>2.1.1</option><option value='https://micronaut-projects.github.io/micronaut-data/2.1.0/guide/index.html'>2.1.0</option><option value='https://micronaut-projects.github.io/micronaut-data/2.0.1/guide/index.html'>2.0.1</option><option value='https://micronaut-projects.github.io/micronaut-data/2.0.0/guide/index.html'>2.0.0</option><option selected value='https://micronaut-projects.github.io/micronaut-data/1.1.3/guide/index.html'>1.1.3</option><option value='https://micronaut-projects.github.io/micronaut-data/1.1.2/guide/index.html'>1.1.2</option><option value='https://micronaut-projects.github.io/micronaut-data/1.1.1/guide/index.html'>1.1.1</option><option value='https://micronaut-projects.github.io/micronaut-data/1.1.0/guide/index.html'>1.1.0</option><option value='https://micronaut-projects.github.io/micronaut-data/1.0.2/guide/index.html'>1.0.2</option><option value='https://micronaut-projects.github.io/micronaut-data/1.0.1/guide/index.html'>1.0.1</option><option value='https://micronaut-projects.github.io/micronaut-data/1.0.0/guide/index.html'>1.0.0</option></select></p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data is a database access toolkit that uses Ahead of Time (AoT) compilation to pre-compute queries for repository interfaces that are then executed by a thin, lightweight runtime layer.</p>
</div>
<div class="paragraph">
<p>Micronaut Data is inspired by <a href="https://gorm.grails.org">GORM</a> and <a href="https://spring.io/projects/spring-data">Spring Data</a>, however improves on those solutions in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>No runtime model</strong> - Both GORM and Spring Data maintain a runtime meta-model that uses reflection to model relationships between entities. This model consumes significant memory and memory requirements grow as your application size grows. The problem is worse when combined with Hibernate which maintains its own meta-model as you end up with duplicate meta-models.</p>
</li>
<li>
<p><strong>No query translation</strong> - Both GORM and Spring Data use regular expressions and pattern matching in combination with runtime generated proxies to translate a method definition on a Java interface into a query at runtime. No such runtime translation exists in Micronaut Data and this work is carried out by the Micronaut compiler at compilation time.</p>
</li>
<li>
<p><strong>No Reflection or Runtime Proxies</strong> - Micronaut Data uses no reflection or runtime proxies, resulting in better performance, smaller stack traces and reduced memory consumption due to a complete lack of reflection caches (Note that the backing implementation, for example Hibernate, may use reflection).</p>
</li>
<li>
<p><strong>Type Safety</strong> - Micronaut Data will actively check at compile time that a repository method can be implemented and fail compilation if it cannot.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut Data provides a general API for translating a compile time Query model into a query at compilation time and provides runtime support for the following backends:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JPA (Hibernate)</p>
</li>
<li>
<p>SQL (JDBC)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further implementations for other databases are planned in the future.</p>
</div>
<div class="paragraph">
<p>The following sections will take you through the basics of querying and using Micronaut Data, if you wish to understand more detail about how Micronaut Data works check out the <a href="#howItWorks">How Micronaut Data Works</a> section.</p>
</div>
<div class="paragraph">
<p>At a fundamental level however what Micronaut Data does can be summed up in the following snippets. Given the following interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package example;

import io.micronaut.data.annotation.*;
import io.micronaut.data.model.*;
import io.micronaut.data.repository.CrudRepository;
import java.util.List;

@Repository <b class="conum">(1)</b>
interface BookRepository extends CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    Book find(String title);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.data.annotation.*
import io.micronaut.data.model.*
import io.micronaut.data.repository.CrudRepository

@Repository <b class="conum">(1)</b>
interface BookRepository extends CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    Book find(String title)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.*
import io.micronaut.data.model.*
import io.micronaut.data.repository.CrudRepository

@Repository <b class="conum">(1)</b>
interface BookRepository : CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    fun find(title: String): Book
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Repository</code> annotation designates <code>BookRepository</code> as a data repository. Since, it is is an interface, the <code>@Repository</code> annotation provides implementations at compilation time.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By extending <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a> you enable automatic generation of CRUD (Create, Read, Update, Delete) operations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut Data computes the query for the <code>find</code> method automatically at compilation time making it available at runtime via annotation metadata:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
BeanContext beanContext;

@Test
void testAnnotationMetadata() {
    String query = beanContext.getBeanDefinition(BookRepository.class) <b class="conum">(1)</b>
            .getRequiredMethod("find", String.class) <b class="conum">(2)</b>
            .getAnnotationMetadata().stringValue(Query.class) <b class="conum">(3)</b>
            .orElse(null);

    assertEquals( <b class="conum">(4)</b>
            "SELECT book_ FROM example.Book AS book_ WHERE (book_.title = :p1)", query);

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject
BeanContext beanContext

void "test annotation metadata"() {
    given:"The value of the Query annotation"
    String query = beanContext.getBeanDefinition(BookRepository.class) <b class="conum">(1)</b>
            .getRequiredMethod("find", String.class) <b class="conum">(2)</b>
            .getAnnotationMetadata()
            .stringValue(Query.class) <b class="conum">(3)</b>
            .orElse(null)

    expect:"The JPA-QL query to be correct" <b class="conum">(4)</b>
    query == "SELECT book_ FROM example.Book AS book_ WHERE (book_.title = :p1)"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var beanContext: BeanContext

@Test
fun testAnnotationMetadata() {
    val query = beanContext.getBeanDefinition(BookRepository::class.java) <b class="conum">(1)</b>
            .getRequiredMethod&lt;Any&gt;("find", String::class.java) <b class="conum">(2)</b>
            .annotationMetadata
            .stringValue(Query::class.java) <b class="conum">(3)</b>
            .orElse(null)


    assertEquals( <b class="conum">(4)</b>
            "SELECT book_ FROM example.Book AS book_ WHERE (book_.title = :p1)",
            query
    )

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> is retrieved from the <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/BeanContext.html">BeanContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>find</code> method is retrieved</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The value of the <a href="../api/io/micronaut/data/annotation/Query.html">@Query</a> annotation is retrieved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The JPA-QL query for the method is correct</td>
</tr>
</table>
</div>

<h2 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>1.1 Release History</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/introduction/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_1_1_0">1.1.0</h4>
<div class="ulist">
<ul>
<li>
<p>Micronaut 1.3.x minimum version</p>
</li>
<li>
<p>Bug Fixes</p>
</li>
<li>
<p>Improvements to GraalVM support</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_0_rc1">1.0.0.RC1</h4>
<div class="ulist">
<ul>
<li>
<p>Support for Spring Data JPA specifications</p>
</li>
<li>
<p>Bug Fixes and Improvements</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_0_m5">1.0.0.M5</h4>
<div class="ulist">
<ul>
<li>
<p>Support for explicit entity updates with the <code>update</code> method</p>
</li>
<li>
<p>Support for cascading inserts in JDBC</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_0_m4">1.0.0.M4</h4>
<div class="ulist">
<ul>
<li>
<p>Support for Soft Delete and query customization with <a href="#whereAnnotation">@Where</a>.</p>
</li>
<li>
<p>Support for Sequences for ID generation in Oracle, Postgres and SQL Server</p>
</li>
<li>
<p>Automatic quoting/escaping of identifiers for generated queries</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_0_m3">1.0.0.M3</h4>
<div class="ulist">
<ul>
<li>
<p>Spring for Transaction Management Now Optional</p>
</li>
<li>
<p>Support for <code>@TransactionalEventListener</code></p>
</li>
<li>
<p>Support for <code>javax.transaction.Transactional</code> usage without Spring</p>
</li>
<li>
<p>Bug Fixes and Improvements</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_0_m2">1.0.0.M2</h4>
<div class="ulist">
<ul>
<li>
<p>Bug Fixes and Improvements</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_1_0_0_m1">1.0.0.M1</h4>
<div class="ulist">
<ul>
<li>
<p>Initial Milestone Release</p>
</li>
</ul>
</div>
</div>

<h1 id="quickStart"><a class="anchor" href="#quickStart"></a>2 Quick Start</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/quickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started with Micronaut Data and JPA add the following dependency to your annotation processor path:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.data:micronaut-data-processor:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-data-processor&lt;/artifactId&gt;
        &lt;version&gt;1.1.3&lt;/version&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin the dependency should be in the <code>kapt</code> scope and for Groovy it should be in <code>compileOnly</code> scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should then configure a runtime dependency that matches the implementation you wish to use. For example for Hibernate/JPA:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-hibernate-jpa:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-hibernate-jpa&lt;/artifactId&gt;
    &lt;version&gt;1.1.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>And ensure the implementation is configured correctly.</p>
</div>
<div class="paragraph">
<p>You can then define an <code>@Entity</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.*;

@Entity
public class Book {
    @Id
    @GeneratedValue
    private Long id;
    private String title;
    private int pages;

    public Book(String title, int pages) {
        this.title = title;
        this.pages = pages;
    }

    public Book() {
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public int getPages() {
        return pages;
    }

    public void setPages(int pages) {
        this.pages = pages;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.Entity
import javax.persistence.GeneratedValue
import javax.persistence.Id

@Entity
class Book {
    @Id
    @GeneratedValue
    Long id
    String title
    int pages

    Book(String title, int pages) {
        this.title = title
        this.pages = pages
    }

    Book() {
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.Entity
import javax.persistence.GeneratedValue
import javax.persistence.Id

@Entity
data class Book(@Id
                @GeneratedValue
                var id: Long,
                var title: String,
                var pages: Int = 0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Followed by an interface that extends from <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a></p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package example;

import io.micronaut.data.annotation.*;
import io.micronaut.data.model.*;
import io.micronaut.data.repository.CrudRepository;
import java.util.List;

@Repository <b class="conum">(1)</b>
interface BookRepository extends CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    Book find(String title);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.data.annotation.*
import io.micronaut.data.model.*
import io.micronaut.data.repository.CrudRepository

@Repository <b class="conum">(1)</b>
interface BookRepository extends CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    Book find(String title)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.*
import io.micronaut.data.model.*
import io.micronaut.data.repository.CrudRepository

@Repository <b class="conum">(1)</b>
interface BookRepository : CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    fun find(title: String): Book
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The interface is annotated with <a href="../api/io/micronaut/data/annotation/Repository.html">@Repository</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>CrudRepository</code> interface take 2 generic arguments, the entity type (in this case <code>Book</code>) and the ID type (in this case <code>Long</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now perform CRUD (Create, Read, Update, Delete) operations on the entity. The implementation of <code>example.BookRepository</code> is created at compilation time. To obtain a reference to it simply inject the bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
BookRepository bookRepository;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject BookRepository bookRepository</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var bookRepository: BookRepository</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_saving_an_instance_create">Saving an Instance (Create)</h3>
<div class="paragraph">
<p>To save an instance use the <code>save</code> method of the <code>CrudRepository</code> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book book = new Book();
book.setTitle("The Stand");
book.setPages(1000);
bookRepository.save(book);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book book = new Book(title:"The Stand", pages:1000)
bookRepository.save(book)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">var book = Book(0,"The Stand", 1000)
bookRepository.save(book)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retrieving_an_instance_read">Retrieving an Instance (Read)</h3>
<div class="paragraph">
<p>To read a book back use <code>findById</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">book = bookRepository.findById(id).orElse(null);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">book = bookRepository.findById(id).orElse(null)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">book = bookRepository.findById(id).orElse(null)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updating_an_instance_update">Updating an Instance (Update)</h3>
<div class="paragraph">
<p>To update an instance use <code>save</code> again:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">book.setTitle("Changed");
bookRepository.save(book);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">book.title = "Changed"
bookRepository.save(book)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">book.title = "Changed"
bookRepository.save(book)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_an_instance_delete">Deleting an Instance (Delete)</h3>
<div class="paragraph">
<p>To delete an instance use <code>deleteById</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bookRepository.deleteById(id);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">bookRepository.deleteById(id)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">bookRepository.deleteById(id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations you have implemented your first Micronaut Data repository! Read on to find out more.</p>
</div>
</div>

<h1 id="buildConfig"><a class="anchor" href="#buildConfig"></a>3 Build Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/buildConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut Data is a build time tool, it will not work correctly unless your build is configured correctly.</p>
</div>
<div class="paragraph">
<p>There are two imporant aspects to Micronaut Data:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The build time annotation processors</p>
</li>
<li>
<p>The runtime APIs</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The build time processor is added by adding the <code>micronaut-data-processor</code> module to your annotation processor configuration in either Gradle or Maven:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.data:micronaut-data-processor:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-data-processor&lt;/artifactId&gt;
        &lt;version&gt;1.1.3&lt;/version&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect3">
<h4 id="_micronaut_data_and_lombok">Micronaut Data and Lombok</h4>
<div class="paragraph">
<p>If you intend to use Lombok with Micronaut Data then you must place the Lombok annotation processor <strong>before</strong> the Micronaut processors in your build configuration since Micronaut needs to see the mutations to the AST that Lombok applies.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Lombok plugins like the Gradle plugin <code>io.franzbecker.gradle-lombok</code> are not supported as they place the annotation processors in an incorrect order.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_data_runtime_dependencies">Micronaut Data Runtime Dependencies</h4>
<div class="paragraph">
<p>At runtime for both Micronaut Data JPA and JDBC you as a minimum need the following:</p>
</div>
<div class="paragraph">
<p><strong>1)</strong> A SQL driver for your database in your build configuration. For example for H2:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"com.h2database:h2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p><strong>2)</strong> A JDBC Connection Pool Module (Hikari, Tomcat JDBC or DBCP ) from the Micronaut SQL project. For example for Tomcat JDBC:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-tomcat")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-tomcat&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p><strong>3)</strong> A configured data source in <code>application.yml</code>. For example for H2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    url: jdbc:h2:mem:devDb
    driverClassName: org.h2.Driver
    username: sa
    password: ''
    schema-generate: CREATE_DROP
    dialect: H2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is in place if you wish to use Hibernate / JPA you must include the dependency on the <code>micronaut-data-hibernate-jpa</code>:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-hibernate-jpa")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-hibernate-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>And add the following configuration in <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jpa:
  default:
    entity-scan:
        packages: 'example.domain'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>jpa.default.entity-scan.packages</code> references the root package where your <code>@Entity</code> classes are located.</p>
</div>
<div class="paragraph">
<p>Or if you wish to use SQL then the <code>micronaut-data-jdbc</code> module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-jdbc")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-jdbc&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
</div>

<h1 id="repositories"><a class="anchor" href="#repositories"></a>4 Repository Interfaces</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/repositories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As seen in the <a href="#quickStart">Quick Start</a> repositories in Micronaut Data are defined as interfaces that are annotated with the <a href="../api/io/micronaut/data/annotation/Repository.html">@Repository</a> annotation.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/data/annotation/Repository.html">@Repository</a> annotation accepts an optional string value which represents the name of the connection or datasource in a multiple datasource scenario. By default Micronaut Data will look for the default datasource.</p>
</div>
<div class="paragraph">
<p>The entity to treat as the root entity for the purposes of querying is established either from the method signature or from the generic type parameter specified to the <a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a> interface.</p>
</div>
<div class="paragraph">
<p>If no root entity can be established then a compilation error will occur.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the repository interfaces that come with Micronaut Data:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Builtin Repository Interfaces</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A root interface that features no methods but defines the entity type and ID type as generic arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extends <a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a> and adds methods to perform CRUD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/repository/async/AsyncCrudRepository.html">AsyncCrudRepository</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extends <a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a> and adds methods for asynchronous CRUD execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/repository/reactive/ReactiveStreamsCrudRepository.html">ReactiveStreamsCrudRepository</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extends <a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a> and adds methods for reactive CRUD execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/repository/reactive/RxJavaCrudRepository.html">RxJavaCrudRepository</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extends <a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a> and adds methods for reactive CRUD execution using RxJava 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/repository/PageableRepository.html">PageableRepository</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extends <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a> and adds methods for pagination</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that in addition to interfaces you can also define repositories as abstract classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.data.annotation.Repository;
import io.micronaut.data.repository.CrudRepository;

import javax.persistence.EntityManager;
import java.util.List;

@Repository
public abstract class AbstractBookRepository implements CrudRepository&lt;Book, Long&gt; {

    private final EntityManager entityManager;

    public AbstractBookRepository(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    public List&lt;Book&gt; findByTitle(String title) {
        return entityManager.createQuery("FROM Book AS book WHERE book.title = :title", Book.class)
                    .setParameter("title", title)
                    .getResultList();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.data.annotation.Repository
import io.micronaut.data.repository.CrudRepository

import javax.persistence.EntityManager

@Repository
abstract class AbstractBookRepository implements CrudRepository&lt;Book, Long&gt; {

    private final EntityManager entityManager

    AbstractBookRepository(EntityManager entityManager) {
        this.entityManager = entityManager
    }

    List&lt;Book&gt; findByTitle(String title) {
        return entityManager.createQuery("FROM Book AS book WHERE book.title = :title", Book)
                .setParameter("title", title)
                .getResultList()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.Repository
import io.micronaut.data.repository.CrudRepository

import javax.persistence.EntityManager

@Repository
abstract class AbstractBookRepository(private val entityManager: EntityManager) : CrudRepository&lt;Book, Long&gt; {

    fun findByTitle(title: String): List&lt;Book&gt; {
        return entityManager.createQuery("FROM Book AS book WHERE book.title = :title", Book::class.java)
                .setParameter("title", title)
                .resultList
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the above example, using abstract classes can be useful as it allows you to combine custom code that interacts with JPA and repository interface code implemented automatically by Micronaut Data.</p>
</div>

<h1 id="querying"><a class="anchor" href="#querying"></a>5 Writing Queries</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The implementation of querying in Micronaut Data is based on the dynamic finders in <a href="https://gorm.grails.org">GORM</a>.</p>
</div>
<div class="paragraph">
<p>A pattern matching approach is taken at compilation time. The general pattern of query methods is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/finderpattern.svg" alt="finderpattern">
</div>
<div class="title">Figure 1. Query Method Pattern</div>
</div>
<div class="paragraph">
<p>As shown in Figure 1, the most common query stem is <code>find</code>, but you can also use <code>search</code>, <code>query</code>, <code>get</code>, <code>read</code> or <code>retrieve</code>.</p>
</div>
<div class="paragraph">
<p>The projection and ordering parts of the query pattern are optional (more on those later). The following snippet demonstrates 3 simple queries that use a different stem but perform the same query:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book findByTitle(String title);

Book getByTitle(String title);

Book retrieveByTitle(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book findByTitle(String title)

Book getByTitle(String title)

Book retrieveByTitle(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findByTitle(title: String): Book

fun getByTitle(title: String): Book

fun retrieveByTitle(title: String): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above examples return a single instance of an entity, the supported return types are described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Supported Return Types for Finder Methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Return Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>java.util.List</code> or any common <code>Iterable</code> type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>java.util.stream.Stream</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional value, if <code>null</code> is retrieved otherwise a <a href="../api/io/micronaut/data/exceptions/EmptyResultException.html">EmptyResultException</a> is thrown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Page&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An instance of <a href="../api/io/micronaut/data/model/Page.html">Page</a> for pagination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Slice&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An instance of <a href="../api/io/micronaut/data/model/Slice.html">Slice</a> for pagination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Future&lt;Book&gt;</code> or <code>CompletableFuture&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>java.util.concurrent.Future</code> for asynchronous execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;Book&gt;</code> (or <code>Single</code>, <code>Maybe</code>, <code>Flux</code>, <code>Mono</code> etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An Reactive Streams compatible type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primitive/Simple Types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In the case of projections primitive/basic types can be returned</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, to the standard <code>findBy*</code> pattern, a few other patterns exist that have special return type requirements.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the possible alternative patterns, behaviour and expected return types:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Method Patterns and Return Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Pattern</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expected Return Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countBy*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primitive number of an instance of <code>java.lang.Number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of records</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>existsBy*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A primitive or wrapper <code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether a record exists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteBy*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>void</code> or <code>Number</code> return type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch delete for the given finder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updateBy*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>void</code> or <code>Number</code> return type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch update for the given finder</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More details about the batch update variants of these methods is covered in the <a href="#dataUpdates">Data Updates</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, as an alternative to the <code>By</code> syntax you also define simple finders that use the parameter names to match properties to query. This syntax is less flexible, but is more readable in certain circumstances. For example the following can be used as an alternative to <code>findByTitle</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book find(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book find(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun find(title: String): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this case if the <code>title</code> parameter does not exist as a property in the entity being queried or the type does not match up a compilation error will occur. Also you can specify more than one parameter to perform a logical <code>AND</code>.</p>
</div>

<h2 id="criteria"><a class="anchor" href="#criteria"></a>5.1 Query Criteria</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/criteria.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous example presented a simple <code>findByTitle</code> query which searches for all <code>Book</code> instances that have a <code>title</code> property <em>equal to</em> the given value.</p>
</div>
<div class="paragraph">
<p>This is the simplest type of query supported by Micronaut Data, but you can use an optional suffix on the property name to modify the type of criterion to apply.</p>
</div>
<div class="paragraph">
<p>For example the following query pattern will execute a query that finds only <code>Book</code> instances that have a page count greater than the given value:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Book&gt; findByPagesGreaterThan(int pageCount);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">List&lt;Book&gt; findByPagesGreaterThan(int pageCount)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findByPagesGreaterThan(pageCount: Int): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table summarizes the possible expressions and behaviour:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Property Criterion Expressions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example Suffix</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sample</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is after the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByDateCreatedAfter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is before the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByDateCreatedBefore</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Contains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property contains the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleContains</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartsWith</code> or <code>StartingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property starts with the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleStartsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndsWith</code> or <code>EndingWith</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property ends with the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleEndsWith</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Equals</code> or <code>Equal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results equal to the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleEquals</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotEquals</code> or <code>NotEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results not equal to the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleNotEquals</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is greater than the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPagesGreaterThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEquals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is greater than or equal to the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPagesGreaterThanEquals</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is less than the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPagesLessThan</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEquals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is less than or equal to the given value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByPagesLessThanEquals</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds string values "like" the given expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleLike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ilike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Case insensitive "like" query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleIlike</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InList</code> or <code>In</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is that are contained within the given list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByTitleInList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code> or <code>InRange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find results where the property is between the given values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByDateCreatedBetween</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds results where the property is <code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAuthorIsNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds results where the property is not <code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAuthorIsNotNull</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsEmpty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds results where the property is empty or <code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAuthorIsEmpty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotEmpty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds results where the property is not empty or <code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAuthorIsNotEmpty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds results where the property is true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAuthorEnabledTrue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds results where the property is false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAuthorEnabledFalse</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Any of these criterion expressions can be negated by adding the word <code>Not</code> before the expression (for example <code>NotInList</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can combine multiple criterion by separating them with <code>And</code> or <code>Or</code> logical operators. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Book&gt; findByPagesGreaterThanOrTitleLike(int pageCount, String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">List&lt;Book&gt; findByPagesGreaterThanOrTitleLike(int pageCount, String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findByPagesGreaterThanOrTitleLike(pageCount: Int, title: String): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses <code>Or</code> to express a greater than condition and a like condition.</p>
</div>
<div class="paragraph">
<p>You can also negate any of the aforementioned expressions by adding <code>Not</code> prior the name of the expression (example <code>NotTrue</code> or <code>NotContain</code>).</p>
</div>

<h2 id="pagination"><a class="anchor" href="#pagination"></a>5.2 Pagination</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/pagination.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Typically when returning multiple records you need some control over paging the data. Micronaut Data includes the ability to specify pagination requirements with the <a href="../api/io/micronaut/data/model/Pageable.html">Pageable</a> type (inspired by GORM&#8217;s <a href="https://gorm.grails.org/latest/api/grails/orm/PagedResultList.html">PagedResultList</a> and Spring Data&#8217;s <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html">Pageable</a>).</p>
</div>
<div class="paragraph">
<p>In addition methods can return a <a href="../api/io/micronaut/data/model/Page.html">Page</a> object which includes the execution of an additional query to obtain the total number of results for a given query.</p>
</div>
<div class="paragraph">
<p>The following are some example signatures:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Book&gt; findByPagesGreaterThan(int pageCount, Pageable pageable);

Page&lt;Book&gt; findByTitleLike(String title, Pageable pageable);

Slice&lt;Book&gt; list(Pageable pageable);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">List&lt;Book&gt; findByPagesGreaterThan(int pageCount, Pageable pageable)

Page&lt;Book&gt; findByTitleLike(String title, Pageable pageable)

Slice&lt;Book&gt; list(Pageable pageable)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findByPagesGreaterThan(pageCount: Int, pageable: Pageable): List&lt;Book&gt;

fun findByTitleLike(title: String, pageable: Pageable): Page&lt;Book&gt;

fun list(pageable: Pageable): Slice&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And some test data:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bookRepository.saveAll(Arrays.asList(new Book("The Stand", 1000), new Book("The Shining", 600),
        new Book("The Power of the Dog", 500), new Book("The Border", 700),
        new Book("Along Came a Spider", 300), new Book("Pet Cemetery", 400), new Book("A Game of Thrones", 900),
        new Book("A Clash of Kings", 1100)));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">bookRepository.saveAll(Arrays.asList(
        new Book("The Stand", 1000),
        new Book("The Shining", 600),
        new Book("The Power of the Dog", 500),
        new Book("The Border", 700),
        new Book("Along Came a Spider", 300),
        new Book("Pet Cemetery", 400),
        new Book("A Game of Thrones", 900),
        new Book("A Clash of Kings", 1100)
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">bookRepository.saveAll(Arrays.asList(
        Book(0,"The Stand", 1000),
        Book(0,"The Shining", 600),
        Book(0,"The Power of the Dog", 500),
        Book(0,"The Border", 700),
        Book(0,"Along Came a Spider", 300),
        Book(0,"Pet Cemetery", 400),
        Book(0,"A Game of Thrones", 900),
        Book(0,"A Clash of Kings", 1100)
))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute queries and return paginated data using the <code>from</code> method of <a href="../api/io/micronaut/data/model/Pageable.html">Pageable</a> and specifying an appropriate return type:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Slice&lt;Book&gt; slice = bookRepository.list(Pageable.from(0, 3));
List&lt;Book&gt; resultList = bookRepository.findByPagesGreaterThan(500, Pageable.from(0, 3));
Page&lt;Book&gt; page = bookRepository.findByTitleLike("The%", Pageable.from(0, 3));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Slice&lt;Book&gt; slice = bookRepository.list(Pageable.from(0, 3))
List&lt;Book&gt; resultList =
        bookRepository.findByPagesGreaterThan(500, Pageable.from(0, 3))
Page&lt;Book&gt; page = bookRepository.findByTitleLike("The%", Pageable.from(0, 3))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">val slice = bookRepository.list(Pageable.from(0, 3))
val resultList = bookRepository.findByPagesGreaterThan(500, Pageable.from(0, 3))
val page = bookRepository.findByTitleLike("The%", Pageable.from(0, 3))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>from</code> method accepts <code>index</code> and <code>size</code> arguments which are the page number to begin from and the number of records to return per page.</p>
</div>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/data/model/Slice.html">Slice</a> is the same as a <a href="../api/io/micronaut/data/model/Page.html">Page</a> but results in one less query as it excludes the total number of pages calculation.</p>
</div>

<h2 id="ordering"><a class="anchor" href="#ordering"></a>5.3 Ordering</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/ordering.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can control ordering of results by appending an <code>OrderBy*</code> expression to the end of the method name:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Book&gt; listOrderByTitle();

List&lt;Book&gt; listOrderByTitleDesc();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">List&lt;Book&gt; listOrderByTitle()

List&lt;Book&gt; listOrderByTitleDesc()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun listOrderByTitle(): List&lt;Book&gt;

fun listOrderByTitleDesc(): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>OrderBy*</code> expression refer to the property name to order by and can optionally be appended with either <code>Asc</code> or <code>Desc</code> to control ascending or descending order.</p>
</div>

<h2 id="projections"><a class="anchor" href="#projections"></a>5.4 Query Projections</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/projections.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Frequently, rather than retrieving all of the data for a particular entity, you may only want a single property or association of an entity or to perform some kind of computation and obtain just that result. This is where query projections come in.</p>
</div>
<div class="paragraph">
<p>The simplest form of projection is to retrieve a property or association. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;String&gt; findTitleByPagesGreaterThan(int pageCount);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">List&lt;String&gt; findTitleByPagesGreaterThan(int pageCount)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findTitleByPagesGreaterThan(pageCount: Int): List&lt;String&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>findTitleByPagesGreaterThan</code> method is resolving the <code>title</code> property of the <code>Book</code> entity and returning the data as a <code>List</code> of <code>String</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the projected property type and the return generic type do not match up then Micronaut Data will fail to compile the method.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use projections on association paths, for example if an <code>author</code> association were present you could write <code>findAuthorNameByPagesGreaterThan</code> to retrieve the names of all the authors.</p>
</div>
<div class="paragraph">
<p>In addition to this, Micronaut Data also supports projection expressions. The following table summarizes the possible expressions with an example and description:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Projection Expressions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countTitleByPagesGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CountDistinct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countDistinctTitleByPagesGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the distinct values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Distinct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findDistinctTitleByPagesGreaterThan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds the distinct property values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findMaxPagesByTitleLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds the maximum property value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findMinPagesByTitleLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds the minimum property value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findSumPagesByTitleLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds the sum of all the property values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Avg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findAvgPagesByTitleLike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finds the average of all the property values</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also use <code>top</code> or <code>first</code> to limit the results returned (as a simple alternative to pagination)</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Book&gt; findTop3ByTitleLike(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">List&lt;Book&gt; findTop3ByTitleLike(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findTop3ByTitleLike(title: String): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above query will return the first 3 results for the given query expression.</p>
</div>

<h2 id="dto"><a class="anchor" href="#dto"></a>5.5 DTO Projections</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/dto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data supports reflection-free Data Transfer Object (DTO) projections if the return type is annotated with <code>@Introspected</code>.</p>
</div>
<div class="paragraph">
<p>For example if you wanted to project on an entity called <code>Book</code> you could define a DTO as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.core.annotation.Introspected;

@Introspected
public class BookDTO {

    private String title;
    private int pages;

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public int getPages() {
        return pages;
    }

    public void setPages(int pages) {
        this.pages = pages;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.core.annotation.Introspected

@Introspected
class BookDTO {
    String title
    int pages
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.core.annotation.Introspected

@Introspected
data class BookDTO(
    var title: String,
    var pages: Int
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DTO should include properties that match the property names you wish to project on (in this case <code>title</code> and <code>pages</code>). If any properties do not match then a compilation error will occur.</p>
</div>
<div class="paragraph">
<p>You can then use the DTO object as return type in query methods:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">BookDTO findOne(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">BookDTO findOne(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun findOne(title: String): BookDTO</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut Data will optimize the query to only select the necessary properties from the database.</p>
</div>

<h2 id="joinQueries"><a class="anchor" href="#joinQueries"></a>5.6 Join Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/joinQueries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To optimize your queries you may need to alter joins to fetch exactly the data you need in the result set.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If a <code>LazyInitializationException</code> occurs this is not a bug in Micronaut Data or Hibernate, but instead an indication that you should alter your query joins to fetch the associated data you need to implement your use case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Consider a <code>Product</code> entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.*;

@Entity
public class Product {

    @Id
    @GeneratedValue
    private Long id;
    private String name;
    @ManyToOne(optional = false, fetch = FetchType.LAZY)
    private Manufacturer manufacturer;

    public Product(String name, Manufacturer manufacturer) {
        this.name = name;
        this.manufacturer = manufacturer;
    }

    public Product() {
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Manufacturer getManufacturer() {
        return manufacturer;
    }

    public void setManufacturer(Manufacturer manufacturer) {
        this.manufacturer = manufacturer;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.*

@Entity
class Product {

    @Id
    @GeneratedValue
    Long id
    String name
    @ManyToOne(optional = false, fetch = FetchType.LAZY)
    Manufacturer manufacturer

    Product(String name, Manufacturer manufacturer) {
        this.name = name
        this.manufacturer = manufacturer
    }

    Product() {
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.*

@Entity
data class Product(
    @Id
    @GeneratedValue
    var id: Long?,
    var name: String,
    @ManyToOne(optional = false, fetch = FetchType.LAZY)
    var manufacturer: Manufacturer
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That has an association to a <code>Manufacturer</code> entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import org.hibernate.annotations.BatchSize;

import javax.persistence.*;

@Entity
@BatchSize(size = 10)
public class Manufacturer {
    @Id
    @GeneratedValue
    private Long id;
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.*

@Entity
class Manufacturer {

    @Id
    @GeneratedValue
    Long id
    String name
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.*

@Entity
data class Manufacturer(
    @Id
    @GeneratedValue
    var id: Long?,
    var name: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case when you read each <code>Product</code> from the database an additional select is required to retrieve the <code>Manufacturer</code> for each <code>Product</code>. This leads to <code>N + 1</code> queries.</p>
</div>
<div class="paragraph">
<p>To resolve this you can use the <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation on your repository interface to specify that a <code>JOIN FETCH</code> should be executed to retrieve the associated <code>Manufacturer</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Repository
public interface ProductRepository extends CrudRepository&lt;Product, Long&gt; {
    @Join(value = "manufacturer", type = Join.Type.FETCH) <b class="conum">(1)</b>
    List&lt;Product&gt; list();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Repository
interface ProductRepository extends CrudRepository&lt;Product, Long&gt; {
    @Join(value = "manufacturer", type = Join.Type.FETCH) <b class="conum">(1)</b>
    List&lt;Product&gt; list()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Repository
interface ProductRepository : CrudRepository&lt;Product, Long&gt; {
    @Join(value = "manufacturer", type = Join.Type.FETCH) <b class="conum">(1)</b>
    fun list(): List&lt;Product&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> is used to indicate a <code>JOIN FETCH</code> clause should be included.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation is repeatable and hence can be specified multiple times for different associations. In addition, the <code>type</code> member of the annotation can be used to specify the join type, for example <code>LEFT</code>, <code>INNER</code> or <code>RIGHT</code>.</p>
</div>
<div class="sect2">
<h3 id="_jpa_2_1_entity_graphs">JPA 2.1 Entity Graphs</h3>
<div class="paragraph">
<p>A JPA-specific alternative to specifying the joins to a query is to use JPA 2.1 entity graphs. With entity graphs you defer to the JPA implementation to pick the appropriate join type to use:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@EntityGraph(attributePaths = {"manufacturer", "title"}) <b class="conum">(1)</b>
List&lt;Product&gt; findAll();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@EntityGraph(attributePaths = ["manufacturer", "title"]) <b class="conum">(1)</b>
List&lt;Product&gt; findAll()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@EntityGraph(attributePaths = ["manufacturer", "title"]) <b class="conum">(1)</b>
override fun findAll(): List&lt;Product&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>attributePaths</code> member is used to specify the paths to include in the Entity graph.</td>
</tr>
</table>
</div>
</div>

<h2 id="explicitQueries"><a class="anchor" href="#explicitQueries"></a>5.7 Explicit Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/explicitQueries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you want to have more control over the JPA-QL query then you can use the <a href="../api/io/micronaut/data/annotation/Query.html">@Query</a> annotation to specify an explicit query:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Query("FROM Book b WHERE b.title = :t ORDER BY b.title")
List&lt;Book&gt; listBooks(String t);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Query("FROM Book b WHERE b.title = :t ORDER BY b.title")
List&lt;Book&gt; listBooks(String t)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Query("FROM Book b WHERE b.title = :t ORDER BY b.title")
fun listBooks(t: String): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You specify named parameters using colon (<code>:</code>) followed by the name and these must match a parameter specified to the method otherwise a compilation error will occur.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently Micronaut Data does not parse the JPA-QL AST and perform any further type checking hence greater care should be taken when using explicit queries. This may change in a future version of Micronaut Data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if the method returns a <a href="../api/io/micronaut/data/model/Page.html">Page</a> for pagination then you must additionally specify a query that performs the equivalent count using the <code>countQuery</code> member of the <a href="../api/io/micronaut/data/annotation/Query.html">@Query</a> annotation.</p>
</div>

<h2 id="whereAnnotation"><a class="anchor" href="#whereAnnotation"></a>5.8 Modifying Queries with @Where</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/whereAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use the <a href="../api/io/micronaut/data/annotation/Where.html">@Where</a> annotation to modify compile time generated query with additional query criterion.</p>
</div>
<div class="paragraph">
<p>A common use case for this is to implement soft delete. For example considering the following <code>User</code> entity which declares an <code>enabled</code> property:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.data.annotation.*;

@MappedEntity
@Where("enabled = true") <b class="conum">(1)</b>
public class User {
    @GeneratedValue
    @Id
    private Long id;
    private String name;
    private boolean enabled = true; <b class="conum">(2)</b>

    public User(String name) {
        this.name = name;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import groovy.transform.EqualsAndHashCode
import io.micronaut.data.annotation.*

@MappedEntity
@Where("enabled = true") <b class="conum">(1)</b>
@EqualsAndHashCode(includes = "name")
class User {
    @GeneratedValue
    @Id
    Long id
    String name
    boolean enabled = true <b class="conum">(2)</b>

    User(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.Where
import javax.persistence.Entity
import javax.persistence.GeneratedValue
import javax.persistence.Id


@Entity
@Where("enabled = true") <b class="conum">(1)</b>
data class User(
    @GeneratedValue
    @Id
    var id: Long,
    val name: String,
    val enabled: Boolean <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/data/annotation/Where.html">@Where</a> annotation is used to declare that all queries should include <code>enabled = true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An <code>enabled</code> property exists on the entity</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then easily modify the <code>delete</code> operations to instead issue an update. For example, consider the following repository implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import edu.umd.cs.findbugs.annotations.NonNull;
import io.micronaut.data.annotation.Query;
import io.micronaut.data.jdbc.annotation.JdbcRepository;
import io.micronaut.data.model.query.builder.sql.Dialect;
import io.micronaut.data.repository.CrudRepository;
import javax.validation.constraints.NotNull;
import java.util.List;

@JdbcRepository(dialect = Dialect.H2)
public interface UserRepository extends CrudRepository&lt;User, Long&gt; { <b class="conum">(1)</b>

    @Override
    @Query("UPDATE user SET enabled = false WHERE id = :id") <b class="conum">(2)</b>
    void deleteById(@NonNull @NotNull Long id);

    @Query("SELECT * FROM user WHERE enabled = false") <b class="conum">(3)</b>
    List&lt;User&gt; findDisabled();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import edu.umd.cs.findbugs.annotations.NonNull
import io.micronaut.data.annotation.Query
import io.micronaut.data.jdbc.annotation.JdbcRepository
import io.micronaut.data.model.query.builder.sql.Dialect
import io.micronaut.data.repository.CrudRepository

import javax.validation.constraints.NotNull

@JdbcRepository(dialect = Dialect.H2)
interface UserRepository extends CrudRepository&lt;User, Long&gt; { <b class="conum">(1)</b>

    @Override
    @Query("UPDATE user SET enabled = false WHERE id = :id") <b class="conum">(2)</b>
    void deleteById(@NonNull @NotNull Long id)

    @Query("SELECT * FROM user WHERE enabled = false") <b class="conum">(3)</b>
    List&lt;User&gt; findDisabled()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.Query
import io.micronaut.data.jdbc.annotation.JdbcRepository
import io.micronaut.data.model.query.builder.sql.Dialect
import io.micronaut.data.repository.CrudRepository
import javax.validation.constraints.NotNull

@JdbcRepository(dialect = Dialect.H2)
interface UserRepository : CrudRepository&lt;User, Long&gt; { <b class="conum">(1)</b>

    @Query("UPDATE user SET enabled = false WHERE id = :id") <b class="conum">(2)</b>
    override fun deleteById(@NotNull id: Long)

    @Query("SELECT * FROM user WHERE enabled = false") <b class="conum">(3)</b>
    fun findDisabled(): List&lt;User&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The interface extends <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>deleteById</code> is overridden to perform a soft delete by setting <code>enabled</code> to false.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An additional method is added to return disabled entities if needed using an explicit query.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All other queries performed on the entity will include <code>enabled = true</code> in the query statement.</p>
</div>

<h2 id="nativeQueries"><a class="anchor" href="#nativeQueries"></a>5.9 Native Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/nativeQueries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When using Micronaut Data with JPA you can execute native SQL queries by setting <code>nativeQuery</code> to true in the <a href="../api/io/micronaut/data/annotation/Query.html">@Query</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Query(value = "select * from books b where b.title like :title limit 5",
       nativeQuery = true)
List&lt;Book&gt; findNativeBooks(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Query(value = "select * from books b where b.title like :title limit 5",
        nativeQuery = true)
List&lt;Book&gt; findNativeBooks(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Query(value = "select * from books b where b.title like :title limit 5", nativeQuery = true)
fun findNativeBooks(title: String): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will execute the raw SQL against the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For <a href="#pagination">Pagination</a> queries that return a <a href="../api/io/micronaut/data/model/Page.html">Page</a> you also need to specify a native <code>countQuery</code>.
</td>
</tr>
</table>
</div>

<h2 id="async"><a class="anchor" href="#async"></a>5.10 Asynchronous Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/async.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data supports asynchronous query execution by defining methods that return either <code>CompletionStage</code>, <code>CompletableFuture</code> or <code>Future</code>.</p>
</div>
<div class="paragraph">
<p>In the case of asynchronous execution and if the backing implementation is blocking, Micronaut Data will use the <a href="https://docs.micronaut.io/latest/guide/index.html#reactiveServer">Configured I/O thread pool</a> to schedule the query execution on a different thread.</p>
</div>
<div class="paragraph">
<p>The following is an example of a couple of asynchronous methods:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Repository
public interface ProductRepository extends CrudRepository&lt;Product, Long&gt; {
    @Join("manufacturer")
    CompletableFuture&lt;Product&gt; findByNameContains(String str);

    CompletableFuture&lt;Long&gt; countByManufacturerName(String name);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Repository
interface ProductRepository extends CrudRepository&lt;Product, Long&gt; {
    @Join("manufacturer")
    CompletableFuture&lt;Product&gt; findByNameContains(String str)

    CompletableFuture&lt;Long&gt; countByManufacturerName(String name)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Repository
interface ProductRepository : CrudRepository&lt;Product, Long&gt; {
    @Join("manufacturer")
    fun findByNameContains(str: String): CompletableFuture&lt;Product&gt;

    fun countByManufacturerName(name: String): CompletableFuture&lt;Long&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines two methods that use <code>CompletableFuture</code> as return type, the API for which you can use to compose query operations:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">long total = productRepository.findByNameContains("o")
        .thenCompose(product -&gt; productRepository.countByManufacturerName(product.getManufacturer().getName()))
        .get(1000, TimeUnit.SECONDS);

Assertions.assertEquals(
        2,
        total
);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">when:"A result is retrieved using async composition"
long total = productRepository.findByNameContains("o")
        .thenCompose { product -&gt; productRepository.countByManufacturerName(product.manufacturer.name) }
        .get(1000, TimeUnit.SECONDS)

then:"the result is correct"
total == 2</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">val total = productRepository.findByNameContains("o")
        .thenCompose { product -&gt; productRepository.countByManufacturerName(product.manufacturer.name) }
        .get(1000, TimeUnit.SECONDS)

Assertions.assertEquals(
        2,
        total
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the case of JPA each operation will run with its own transaction and session, hence care needs to be taken to fetch the correct data and avoid detached objects. In addition for more complex operations it may be more efficient to write custom code that uses a single session.
</td>
</tr>
</table>
</div>

<h2 id="reactive"><a class="anchor" href="#reactive"></a>5.11 Reactive Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/querying/reactive.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data supports reactive query execution by defining methods that return either <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> or a RxJava 2 type.</p>
</div>
<div class="paragraph">
<p>In the case of reactive execution and if the backing implementation is blocking, Micronaut Data will use the <a href="https://docs.micronaut.io/latest/guide/index.html#reactiveServer">Configured I/O thread pool</a> to schedule the query execution on a different thread.</p>
</div>
<div class="paragraph">
<p>If the backing implementation natively supports reactive types at the driver level then the I/O thread pool is not used and instead it is assumed the driver will handle the query in a non-blocking manner.</p>
</div>
<div class="paragraph">
<p>The following is an example of a couple of reactive methods:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Join("manufacturer")
Maybe&lt;Product&gt; queryByNameContains(String str);

Single&lt;Long&gt; countDistinctByManufacturerName(String name);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Join("manufacturer")
Maybe&lt;Product&gt; queryByNameContains(String str)

Single&lt;Long&gt; countDistinctByManufacturerName(String name)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Join("manufacturer")
fun queryByNameContains(str: String): Maybe&lt;Product&gt;

fun countDistinctByManufacturerName(name: String): Single&lt;Long&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines two methods that use reactive return types from RxJava 2, the API for which you can use to compose query operations:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">long total = productRepository.queryByNameContains("o")
        .flatMap(product -&gt; productRepository.countDistinctByManufacturerName(product.getManufacturer().getName())
                                .toMaybe())
        .defaultIfEmpty(0L)
        .blockingGet();

Assertions.assertEquals(
        2,
        total
);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">when:"A result is retrieved with reactive composition"
long total = productRepository.queryByNameContains("o")
        .flatMap { product -&gt; productRepository.countDistinctByManufacturerName(product.manufacturer.name).toMaybe() }
        .defaultIfEmpty(0L)
        .blockingGet()

then:"The result is correct"
total == 2</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">val total = productRepository.queryByNameContains("o")
        .flatMap { product -&gt;
            productRepository.countDistinctByManufacturerName(product.manufacturer.name)
                    .toMaybe()
        }
        .defaultIfEmpty(0L)
        .blockingGet()

Assertions.assertEquals(
        2,
        total
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of JPA each operation will run with its own transaction and session, hence care needs to be taken to fetch the correct data and avoid detached objects.</p>
</div>
<div class="paragraph">
<p>In addition for more complex operations it may be more efficient to write custom code that uses a single session.</p>
</div>

<h1 id="dataUpdates"><a class="anchor" href="#dataUpdates"></a>6 Updating Data</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are various ways to perform write operations with Micronaut Data interfaces.</p>
</div>
<div class="paragraph">
<p>To insert data the simplest form is to define a method that accepts the type of the entity, the same way as the <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a> interface does:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book persist(Book entity);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book persist(Book entity)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun persist(entity: Book): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method must accept a single argument that is the entity and start with either <code>save</code>, <code>persist</code>, <code>insert</code> or <code>store</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively you can also define a method that features parameter names that match the properties of the entity name:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book persist(String title, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book persist(String title, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun persist(title: String, pages: Int): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, when update of whole entity is intended, you must specify parameters for all properties other than those that are declared as <code>@Nullable</code> or as a <code>@GeneratedValue</code>, if you do not a compilation error will occur.</p>
</div>
<div class="paragraph">
<p>For partial updates, you must define a method that features a parameter annotated with <a href="../api/io/micronaut/data/annotation/Id.html">@Id</a> and parameters for the properties to be updated.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void update(@Id Long id, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void update(@Id Long id, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun update(@Id id: Long?, pages: Int)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is not possible to use the entity as the return type in partial updates because it would require an additional select to retrieve the additional information. A number type (int, long, etc) can be returned to indicate the number of rows updated. The updated row count should be checked in most scenarios to ensure the update actually affected the row.
</td>
</tr>
</table>
</div>

<h2 id="transactions"><a class="anchor" href="#transactions"></a>6.1 Transactions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/transactions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data will automatically manage transactions for you. You can simply declare a method as transactional with the <code>javax.transaction.Transactional</code> annotation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you prefer Spring-managed transactions you can add the <code>micronaut-data-spring</code> dependency and Spring-managed transactions will be used instead. See the section on <a href="#spring">Spring Support</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut Data maps the declared transaction annotation to the correct underlying semantics and compilation time.</p>
</div>
<div class="paragraph">
<p>Micronaut Data will also automatically apply read-only transactional semantics to query methods and write transaction semantics to write operations.</p>
</div>

<h2 id="programmaticTransactions"><a class="anchor" href="#programmaticTransactions"></a>6.1.1 Programmatic Transactions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/transactions/programmaticTransactions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use the <a href="../api/io/micronaut/transaction/SynchronousTransactionManager.html">SynchronousTransactionManager</a> API to perform programmatic transactions.</p>
</div>
<div class="paragraph">
<p>The following demonstrates an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.transaction.SynchronousTransactionManager;
import javax.inject.Singleton;
import javax.persistence.EntityManager;
import java.sql.Connection;

@Singleton
public class ProductManager {

    private final EntityManager entityManager;
    private final SynchronousTransactionManager&lt;Connection&gt; transactionManager;

    public ProductManager(
            EntityManager entityManager,
            SynchronousTransactionManager&lt;Connection&gt; transactionManager) { <b class="conum">(1)</b>
        this.entityManager = entityManager;
        this.transactionManager = transactionManager;
    }

    Product save(String name, Manufacturer manufacturer) {
        return transactionManager.executeWrite(status -&gt; { <b class="conum">(2)</b>
            final Product product = new Product(name, manufacturer);
            entityManager.persist(product);
            return product;
        });
    }

    Product find(String name) {
        return transactionManager.executeRead(status -&gt; <b class="conum">(3)</b>
                entityManager.createQuery("from Product p where p.name = :name", Product.class)
                    .setParameter("name", name)
                    .getSingleResult()
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.transaction.SynchronousTransactionManager
import javax.inject.Singleton
import javax.persistence.EntityManager
import java.sql.Connection

@Singleton
class ProductManager {

    private final EntityManager entityManager
    private final SynchronousTransactionManager&lt;Connection&gt; transactionManager

    ProductManager(
            EntityManager entityManager,
            SynchronousTransactionManager&lt;Connection&gt; transactionManager) { <b class="conum">(1)</b>
        this.entityManager = entityManager
        this.transactionManager = transactionManager
    }

    Product save(String name, Manufacturer manufacturer) {
        return transactionManager.executeWrite { <b class="conum">(2)</b>
            final product = new Product(name, manufacturer)
            entityManager.persist(product)
            return product
        }
    }

    Product find(String name) {
        return transactionManager.executeRead { <b class="conum">(3)</b>
            entityManager.createQuery("from Product p where p.name = :name", Product)
                    .setParameter("name", name)
                    .singleResult
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.transaction.SynchronousTransactionManager
import java.sql.Connection
import javax.inject.Singleton
import javax.persistence.EntityManager

@Singleton
class ProductManager(
        private val entityManager: EntityManager,
        private val transactionManager: SynchronousTransactionManager&lt;Connection&gt;) <b class="conum">(1)</b>
{

    fun save(name: String, manufacturer: Manufacturer): Product {
        return transactionManager.executeWrite { <b class="conum">(2)</b>
            val product = Product(0, name, manufacturer)
            entityManager.persist(product)
            product
        }
    }

    fun find(name: String): Product {
        return transactionManager.executeRead {  <b class="conum">(3)</b>
            entityManager.createQuery("from Product p where p.name = :name", Product::class.java)
                    .setParameter("name", name)
                    .singleResult
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The constructor is injected with the <a href="../api/io/micronaut/transaction/SynchronousTransactionManager.html">SynchronousTransactionManager</a> and a transaction-aware <code>EntityManager</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>save</code> method uses the <code>executeWrite</code> method to execute a write transaction within the context of the passed lambda.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>find</code> method uses the <code>executeRead</code> method to execute a read-only transaction within the context of the passed lambda.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if you are using Micronaut Data JDBC then instead of an <code>EntityManager</code> you should inject a transaction-aware JDBC <code>Connection</code> object.</p>
</div>
<div class="paragraph">
<p>The following presents an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.transaction.SynchronousTransactionManager;
import javax.inject.Singleton;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

@Singleton
public class ProductManager {

    private final Connection connection;
    private final SynchronousTransactionManager&lt;Connection&gt; transactionManager;

    public ProductManager(
            Connection connection,
            SynchronousTransactionManager&lt;Connection&gt; transactionManager) { <b class="conum">(1)</b>
        this.connection = connection;
        this.transactionManager = transactionManager;
    }

    Product save(String name, Manufacturer manufacturer) {
        return transactionManager.executeWrite(status -&gt; { <b class="conum">(2)</b>
            final Product product = new Product(name, manufacturer);
            try (PreparedStatement ps =
                         connection.prepareStatement("insert into product (name, manufacturer_id) values (?, ?)")) {
                ps.setString(1, name);
                ps.setLong(2, manufacturer.getId());
                ps.execute();
            }
            return product;
        });
    }

    Product find(String name) {
        return transactionManager.executeRead(status -&gt; { <b class="conum">(3)</b>
            try (PreparedStatement ps = connection
                    .prepareStatement("select * from product p where p.name = ?")) {
                ps.setString(1, name);
                try (ResultSet rs = ps.executeQuery()) {
                    if (rs.next()) {
                        return new Product(rs.getString("name"), null);
                    }
                    return null;
                }
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.transaction.SynchronousTransactionManager
import javax.inject.Singleton
import java.sql.Connection
import java.sql.PreparedStatement
import java.sql.ResultSet

@Singleton
class ProductManager {

    private final Connection connection
    private final SynchronousTransactionManager&lt;Connection&gt; transactionManager

    ProductManager(
            Connection connection,
            SynchronousTransactionManager&lt;Connection&gt; transactionManager) { <b class="conum">(1)</b>
        this.connection = connection
        this.transactionManager = transactionManager
    }

    Product save(String name, Manufacturer manufacturer) {
        return transactionManager.executeWrite { <b class="conum">(2)</b>
            final Product product = new Product(name, manufacturer)
            connection.prepareStatement("insert into product (name, manufacturer_id) values (?, ?)")
                .withCloseable { PreparedStatement ps -&gt;
                    ps.setString(1, name)
                    ps.setLong(2, manufacturer.getId())
                    ps.execute()
                }
            return product
        }
    }

    Product find(String name) {
        return transactionManager.executeRead{ <b class="conum">(3)</b>
            connection
                .prepareStatement("select * from product p where p.name = ?").withCloseable {
                    PreparedStatement ps -&gt;
                ps.setString(1, name)
                ps.executeQuery().withCloseable { ResultSet rs -&gt;
                    if (rs.next()) {
                        return new Product(rs.getString("name"), null)
                    }
                    return null
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.transaction.SynchronousTransactionManager
import java.sql.Connection
import javax.inject.Singleton

@Singleton
class ProductManager(
        private val connection: Connection,
        private val transactionManager: SynchronousTransactionManager&lt;Connection&gt;) <b class="conum">(1)</b>
{

    fun save(name: String, manufacturer: Manufacturer): Product {
        return transactionManager.executeWrite { <b class="conum">(2)</b>
            val product = Product(0, name, manufacturer)
            connection.prepareStatement("insert into product (name, manufacturer_id) values (?, ?)").use { ps -&gt;
                ps.setString(1, name)
                ps.setLong(2, manufacturer.id!!)
                ps.execute()
            }
            product
        }
    }

    fun find(name: String): Product? {
        return transactionManager.executeRead { <b class="conum">(3)</b>
            connection
                    .prepareStatement("select * from product p where p.name = ?").use { ps -&gt;
                        ps.setString(1, name)
                        ps.executeQuery().use { rs -&gt;
                            if (rs.next()) {
                                return@executeRead Product(
                                        rs.getLong("id"),
                                        rs.getString("name"),
                                        null)
                            }
                            return@executeRead null
                        }
                    }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The constructor is injected with the <a href="../api/io/micronaut/transaction/SynchronousTransactionManager.html">SynchronousTransactionManager</a> and a transaction-aware <code>Connection</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>save</code> method uses the <code>executeWrite</code> method to execute a write transaction within the context of the passed lambda.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>find</code> method uses the <code>executeRead</code> method to execute a read-only transaction within the context of the passed lambda.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that it is important that you always use the injected connection as Micronaut Data makes available a transaction-aware implementation that uses the connection associated with the underlying transaction.</p>
</div>
<div class="paragraph">
<p>If a transaction is not active when using this connection then a <a href="../api/io/micronaut/transaction/exceptions/NoTransactionException.html">NoTransactionException</a> will be thrown indicating you should either provide a programmatic transaction or use <code>@Transactional</code>.</p>
</div>

<h2 id="transactionalEvents"><a class="anchor" href="#transactionalEvents"></a>6.1.2 Transactional Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/transactions/transactionalEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can write event listeners that are transaction aware using the <a href="../api/io/micronaut/transaction/annotation/TransactionalEventListener.html">@TransactionalEventListener</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following demonstrates an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.context.event.ApplicationEventPublisher;
import io.micronaut.transaction.annotation.TransactionalEventListener;
import javax.inject.Singleton;
import javax.transaction.Transactional;

@Singleton
public class BookManager {
    private final BookRepository bookRepository;
    private final ApplicationEventPublisher eventPublisher;

    public BookManager(BookRepository bookRepository, ApplicationEventPublisher eventPublisher) { <b class="conum">(1)</b>
        this.bookRepository = bookRepository;
        this.eventPublisher = eventPublisher;
    }

    @Transactional
    void saveBook(String title, int pages) {
        final Book book = new Book(title, pages);
        bookRepository.save(book);
        eventPublisher.publishEvent(new NewBookEvent(book)); <b class="conum">(2)</b>
    }

    @TransactionalEventListener
    void onNewBook(NewBookEvent event) {
        System.out.println("book = " + event.book); <b class="conum">(3)</b>
    }

    static class NewBookEvent {
        final Book book;

        public NewBookEvent(Book book) {
            this.book = book;
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.context.event.ApplicationEventPublisher
import io.micronaut.transaction.annotation.TransactionalEventListener
import javax.inject.Singleton
import javax.transaction.Transactional

@Singleton
class BookManager {
    private final BookRepository bookRepository
    private final ApplicationEventPublisher eventPublisher

    BookManager(BookRepository bookRepository, ApplicationEventPublisher eventPublisher) { <b class="conum">(1)</b>
        this.bookRepository = bookRepository
        this.eventPublisher = eventPublisher
    }

    @Transactional
    void saveBook(String title, int pages) {
        final Book book = new Book(title, pages)
        bookRepository.save(book)
        eventPublisher.publishEvent(new NewBookEvent(book)) <b class="conum">(2)</b>
    }

    @TransactionalEventListener
    void onNewBook(NewBookEvent event) {
        println("book = $event.book") <b class="conum">(3)</b>
    }

    static class NewBookEvent {
        final Book book

        NewBookEvent(Book book) {
            this.book = book
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.context.event.ApplicationEventPublisher
import io.micronaut.transaction.annotation.TransactionalEventListener
import javax.inject.Singleton
import javax.transaction.Transactional

@Singleton
open class BookManager(
        private val bookRepository: BookRepository, private val eventPublisher: ApplicationEventPublisher) { <b class="conum">(1)</b>

    @Transactional
    open fun saveBook(title: String, pages: Int) {
        val book = Book(0, title, pages)
        bookRepository.save(book)
        eventPublisher.publishEvent(NewBookEvent(book)) <b class="conum">(2)</b>
    }

    @TransactionalEventListener
    open fun onNewBook(event: NewBookEvent) {
        println("book = ${event.book}") <b class="conum">(3)</b>
    }

    class NewBookEvent(val book: Book)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>BookManager</code> class receives an instance of <code>ApplicationEventPublisher</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When the event is published if there is a running transaction then it will only trigger the listener once the transaction is committed.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The listener itself is annotated with <a href="../api/io/micronaut/transaction/annotation/TransactionalEventListener.html">@TransactionalEventListener</a></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can set the value of the <a href="../api/io/micronaut/transaction/annotation/TransactionalEventListener.html">@TransactionalEventListener</a> annotation to bind the listener to a particular transaction phase.
</td>
</tr>
</table>
</div>

<h2 id="batchUpdates"><a class="anchor" href="#batchUpdates"></a>6.2 Batch Updates</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/batchUpdates.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To update an entity you can once again pass the entity to the the <code>save</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book persist(Book entity);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book persist(Book entity)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun persist(entity: Book): Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, generally it is more efficient to use batch updates to only update the properties that have actually changed.</p>
</div>
<div class="paragraph">
<p>There are a couple of ways to achieve batch updates. One way is to define a method that features an argument annotated with <a href="../api/io/micronaut/data/annotation/Id.html">@Id</a>, starts with the stem <code>update</code> and returns <code>void</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void update(@Id Long id, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void update(@Id Long id, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun update(@Id id: Long?, pages: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the ID of the entity will be used to query and perform an update on the entity with all the remaining arguments (in this case <code>pages</code>). If an argument does not match an existing property of the entity a compilation error will occur.</p>
</div>
<div class="paragraph">
<p>Another alternative is to use <code>updateBy*</code> (the method should again return <code>void</code> or a <code>Number</code> indicating the number of records that were updated):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void updateByTitle(String title, int pages);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void updateByTitle(String title, int pages)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun updateByTitle(title: String, pages: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case you can use any finder expression to query on arbitrary properties and any remaining arguments that don&#8217;t form part of the query expression are used for the update. Once again if one of the remaining arguments does not match an existing property of the entity a compilation error will occur.</p>
</div>

<h2 id="batchDeletes"><a class="anchor" href="#batchDeletes"></a>6.3 Batch Deletes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/batchDeletes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Batch deletes can be performed in a number of ways. To delete everything (use with care!) you can use <code>deleteAll</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void deleteAll();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void deleteAll()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">override fun deleteAll()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To delete by ID or by the value of a property you can specify a parameter that matches a property of an entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void delete(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void delete(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun delete(title: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, you can also use the <code>deleteBy*</code> pattern (the method must start with <code>delete</code>, <code>remove</code>, <code>erase</code> or <code>eliminate</code>) and any finder expression, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void deleteByTitleLike(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void deleteByTitleLike(String title)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun deleteByTitleLike(title: String)</code></pre>
</div>
</div>

<h2 id="timestamps"><a class="anchor" href="#timestamps"></a>6.4 Entity Timestamps</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/dataUpdates/timestamps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is common to want to add a field that represents the time when an entity was first persisted and the time when it was last updated.</p>
</div>
<div class="paragraph">
<p>You can annotate a property that is a date type of an entity with <a href="../api/io/micronaut/data/annotation/DateCreated.html">@DateCreated</a> which will be automatically populated when saving entities and indicates the date a record was created.</p>
</div>
<div class="paragraph">
<p>You can also annotate a property that is a date type of an entity with <a href="../api/io/micronaut/data/annotation/DateUpdated.html">@DateUpdated</a> which will be automatically populated whenever the entity is updated either via the <code>persist</code> method or when using one of the batch update methods of Micronaut Data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you update the entity with an external SQL statement or custom logic you will need to update the underlying <code>DateUpdated</code> column manually.
</td>
</tr>
</table>
</div>

<h1 id="howItWorks"><a class="anchor" href="#howItWorks"></a>7 How Micronaut Data Works</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/howItWorks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data uses two key features of <a href="https://micronaut.io">Micronaut</a>: The <a href="https://docs.micronaut.io/latest/api/io/micronaut/inject/visitor/TypeElementVisitor.html">TypeElementVisitor</a> API and <a href="https://docs.micronaut.io/latest/guide/index.html#introductionAdvice">Introduction Advice</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut Data defines a <a href="../api/io/micronaut/data/processor/visitors/RepositoryTypeElementVisitor.html">RepositoryTypeElementVisitor</a> that at compilation time visits all interfaces in the source tree that are annotated with the <a href="../api/io/micronaut/data/annotation/Repository.html">@Repository</a> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>RepositoryTypeElementVisitor</code> uses service loader to load all available <a href="../api/io/micronaut/data/processor/visitors/finders/MethodCandidate.html">MethodCandidate</a> implementations and iterate over them.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add additional method candidates by creating a library that depends on <code>micronaut-data-processor</code> and defining the <code>META-INF/services</code> definition for the method candidate. The new library should be added to your annotation processor path.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>MethodCandidate</code> interface features a <code>isMethodMatch</code> method which allows matching a <a href="https://docs.micronaut.io/latest/api/io/micronaut/inject/ast/MethodElement.html">MethodElement</a>. Once a <code>MethodElement</code> has been matched the <code>buildMatchInfo</code> method of the <code>MethodCandidate</code> is invoked which returns an instance of <a href="../api/io/micronaut/data/processor/visitors/finders/MethodMatchInfo.html">MethodMatchInfo</a>.</p>
</div>
<div class="paragraph">
<p>The constructor for <code>MethodMatchInfo</code> allows specifying the runtime <a href="../api/io/micronaut/data/intercept/DataInterceptor.html">DataInterceptor</a> to execute, which typically differs based on the return type and behaviour required and an optional <a href="../api/io/micronaut/data/model/query/Query.html">Query</a> instance which represents the query model of the query to be executed.</p>
</div>
<div class="paragraph">
<p>The <code>RepositoryTypeElementVisitor</code> takes the <code>MethodMatchInfo</code> and converts the <a href="../api/io/micronaut/data/model/query/Query.html">Query</a> instance into the equivalent String-based query (such as JPA-QL) using the <a href="../api/io/micronaut/data/model/query/builder/QueryBuilder.html">QueryBuilder</a> that is configured by the <a href="../api/io/micronaut/data/annotation/Repository.html">@Repository</a> annotation.</p>
</div>
<div class="paragraph">
<p>A binding between runtime method parameters and named query parameters is also created.</p>
</div>
<div class="paragraph">
<p>The visited <code>MethodElement</code> is then dynamically annotated with the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The constructed string-based query (for example JPA-QL)</p>
</li>
<li>
<p>The parameter binding (A map containing the named parameter in the query as key and the name of the method argument as a value)</p>
</li>
<li>
<p>The runtime <a href="../api/io/micronaut/data/intercept/DataInterceptor.html">DataInterceptor</a> to execute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At runtime all the <a href="../api/io/micronaut/data/intercept/DataInterceptor.html">DataInterceptor</a> has to do is retrieve the query, read the method parameter values using the parameter binding and execute the query.</p>
</div>

<h1 id="sql"><a class="anchor" href="#sql"></a>8 Micronaut Data with SQL</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to JPA, Micronaut Data supports the generation of repositories that use native SQL. The implementation is general enough that any transport can use be used for executing the SQL queries, as of this writing JDBC is the only supported implementation for executing SQL queries, however this may change in the future.</p>
</div>

<h2 id="jdbc"><a class="anchor" href="#jdbc"></a>8.1 Micronaut Data JDBC</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data JDBC is an implementation that pre-computes native SQL queries (given a particular database dialect) and provides a repository implementation that is a simple data mapper between a JDBC <code>ResultSet</code> and an object.</p>
</div>
<div class="paragraph">
<p>Micronaut Data JDBC supports all of the features of Micronaut Data for JPA including <a href="#criteria">dynamic finders</a>, <a href="#pagination">pagination</a>, <a href="#projections">projections</a>, <a href="#dto">Data Transfer Objects (DTO)</a>, <a href="#dataUpdates">Batch Updates</a> and so on.</p>
</div>
<div class="paragraph">
<p>However, Micronaut Data JDBC is not a Object Relational Mapping (ORM) implementation and does not and will not include any of the following concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lazy Loading or Proxying of Associations</p>
</li>
<li>
<p>Dirty Checking</p>
</li>
<li>
<p>Persistence Contexts / Sessions</p>
</li>
<li>
<p>First Level Caching and Entity Proxies</p>
</li>
<li>
<p>Optimistic Locking</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut Data JDBC is designed for users who prefer a lower-level experience and working directly with SQL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut Data JDBC is useful for implementing the majority of the simple SQL queries that exist in a typical application and does not include any runtime query building DSLs. For more complex queries Micronaut Data JDBC can be paired with one of the many great existing Java SQL DSLs out there like <a href="https://www.jooq.org">JOOQ</a>, <a href="http://www.querydsl.com">QueryDSL</a>, <a href="https://github.com/requery/requery">Requery</a> or even JPA.
</td>
</tr>
</table>
</div>

<h2 id="jdbcQuickStart"><a class="anchor" href="#jdbcQuickStart"></a>8.1.1 JDBC Quick Start</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcQuickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started with Micronaut Data and SQL/JDBC add the following dependency to your annotation processor path:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.data:micronaut-data-processor:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-data-processor&lt;/artifactId&gt;
        &lt;version&gt;1.1.3&lt;/version&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin the dependency should be in the <code>kapt</code> scope and for Groovy it should be in <code>compileOnly</code> scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should then configure a compile scoped dependency on the <code>micronaut-data-jdbc</code> module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-jdbc:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-jdbc&lt;/artifactId&gt;
    &lt;version&gt;1.1.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You should also ensure you have the JDBC driver and connection pool dependencies configured. For example for H2 in-memory database driver:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"com.h2database:h2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>And Hikari connection pool:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-hikari")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-hikari&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Next up you need to configure at least one data source. The following snippet from <code>application.yml</code> is an example of configuring the default JDBC data source:</p>
</div>
<div class="listingblock">
<div class="title">Example YAML configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    url: jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE
    driverClassName: org.h2.Driver
    username: sa
    password: ''
    schema-generate: CREATE_DROP
    dialect: H2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>schema-generate</code> setting is only useful for demos and testing trivial examples, for production usage it is recommended you pair Micronaut Data with a SQL migration tool such as <a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/index.html">Flyway</a> or <a href="https://micronaut-projects.github.io/micronaut-liquibase/latest/guide/index.html">Liquibase</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To retrieve objects from the database you need to define a class annotated with <a href="../api/io/micronaut/data/annotation/MappedEntity.html">@MappedEntity</a>. Note that this is a meta annotation and in fact if you prefer you can use JPA annotations (only a subset are supported, more on that later). If you wish to use JPA annotations include the following <code>compileOnly</code> scoped dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">compileOnly(<span class="hljs-string">"jakarta.persistence:jakarta.persistence-api:2.2.2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;jakarta.persistence&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.persistence-api&lt;/artifactId&gt;
    &lt;version&gt;2.2.2&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>As above since only the annotations are used the dependency can be included only for compilation and not at runtime so you don&#8217;t drag along the rest of the API, reducing your JAR file size.</p>
</div>
<div class="paragraph">
<p>You can then define an <code>@Entity</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.*;

@Entity
public class Book {
    @Id
    @GeneratedValue
    private Long id;
    private String title;
    private int pages;

    public Book(String title, int pages) {
        this.title = title;
        this.pages = pages;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getTitle() {
        return title;
    }

    public int getPages() {
        return pages;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.*

@Entity
class Book {
    @Id
    @GeneratedValue
    Long id
    private String title
    private int pages

    Book(String title, int pages) {
        this.title = title
        this.pages = pages
    }

    String getTitle() {
        return title
    }

    int getPages() {
        return pages
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.Entity
import javax.persistence.GeneratedValue
import javax.persistence.Id

@Entity
data class Book(@Id
                @GeneratedValue
                var id: Long,
                var title: String,
                var pages: Int = 0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Followed by an interface that extends from <a href="../api/io/micronaut/data/repository/CrudRepository.html">CrudRepository</a></p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    Book find(String title);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.data.annotation.*
import io.micronaut.data.jdbc.annotation.JdbcRepository
import io.micronaut.data.model.*
import io.micronaut.data.model.query.builder.sql.Dialect
import io.micronaut.data.repository.CrudRepository
import java.util.List


@JdbcRepository(dialect = Dialect.H2)        <b class="conum">(1)</b>
interface BookRepository extends CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    Book find(String title);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.*
import io.micronaut.data.jdbc.annotation.JdbcRepository
import io.micronaut.data.model.*
import io.micronaut.data.model.query.builder.sql.Dialect
import io.micronaut.data.repository.CrudRepository

@JdbcRepository(dialect = Dialect.H2) <b class="conum">(1)</b>
interface BookRepository : CrudRepository&lt;Book, Long&gt; { <b class="conum">(2)</b>
    fun find(title: String): Book
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The interface is annotated with <a href="../api/io/micronaut/data/jdbc/annotation/JdbcRepository.html">@JdbcRepository</a> and specifies a dialect of <code>H2</code> used to generate queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>CrudRepository</code> interface take 2 generic arguments, the entity type (in this case <code>Book</code>) and the ID type (in this case <code>Long</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now perform CRUD (Create, Read, Update, Delete) operations on the entity. The implementation of <code>example.BookRepository</code> is created at compilation time. To obtain a reference to it simply inject the bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject BookRepository bookRepository;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Inject @Shared BookRepository bookRepository</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Inject
lateinit var bookRepository: BookRepository</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_saving_an_instance_create">Saving an Instance (Create)</h3>
<div class="paragraph">
<p>To save an instance use the <code>save</code> method of the <code>CrudRepository</code> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Book book = new Book("The Stand", 1000);
bookRepository.save(book);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">Book book = new Book("The Stand", 1000)
bookRepository.save(book)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">var book = Book(0,"The Stand", 1000)
bookRepository.save(book)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unlike the JPA implementation there is no dirty checking so <code>save</code> always performs a SQL <code>INSERT</code>. For batch updates use an <code>update</code> method (see following section).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_retrieving_an_instance_read">Retrieving an Instance (Read)</h3>
<div class="paragraph">
<p>To read a book back use <code>findById</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">book = bookRepository.findById(id).orElse(null);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">book = bookRepository.findById(id).orElse(null)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">book = bookRepository.findById(id).orElse(null)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updating_an_instance_update">Updating an Instance (Update)</h3>
<div class="paragraph">
<p>With Micronaut Data JDBC, you must manually implement an <code>update</code> method since the JDBC implementation doesn&#8217;t include any dirty checking or persistence session notion. So you have to define explicit update methods for updates in your repository. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void update(@Id Long id, int pages);

void update(@Id Long id, String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void update(@Id Long id, int pages);

void update(@Id Long id, String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun update(@Id id: Long?, pages: Int)

fun update(@Id id: Long?, title: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which can then be called like so:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bookRepository.update(book.getId(), "Changed");</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">bookRepository.update(book.getId(), "Changed")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">bookRepository.update(book.id, "Changed")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_an_instance_delete">Deleting an Instance (Delete)</h3>
<div class="paragraph">
<p>To delete an instance use <code>deleteById</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">bookRepository.deleteById(id);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">bookRepository.deleteById(id)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">bookRepository.deleteById(id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations you have implemented your first Micronaut Data JDBC repository! Read on to find out more.</p>
</div>
</div>

<h2 id="jdbcConfiguration"><a class="anchor" href="#jdbcConfiguration"></a>8.1.2 JDBC Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data JDBC requires that an appropriate <code>java.sql.DataSource</code> bean is configured.</p>
</div>
<div class="paragraph">
<p>You can either do this manually or use the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#jdbc">Micronaut JDBC</a> module which provides out-of-the-box support for configuring connection pooling with either Tomcat JDBC, Hikari, Commons DBCP or Oracle UDP.</p>
</div>
<div class="sect2">
<h3 id="_sql_logging">SQL Logging</h3>
<div class="paragraph">
<p>You can enable SQL logging by enabling trace logging for the <code>io.micronaut.data.query</code> logger. For example in <code>logback.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling SQL Query Logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.data.query" level="trace" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_schema">Creating the Schema</h3>
<div class="paragraph">
<p>To create the database schema it is recommended you pair Micronaut Data with a SQL migration tool such as <a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/index.html">Flyway</a> or <a href="https://micronaut-projects.github.io/micronaut-liquibase/latest/guide/index.html">Liquibase</a>.</p>
</div>
<div class="paragraph">
<p>SQL migration tools provide more complete support for creating and evolving your schema across a range of databases.</p>
</div>
<div class="paragraph">
<p>If you want to quickly test out Micronaut Data then you can set the <code>schema-generate</code> option of the data source to <code>create-drop</code> as well as the appropriate schema name:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>schema-generate</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    url: jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE
    driverClassName: org.h2.Driver
    username: sa
    password: ''
    schema-generate: CREATE_DROP
    dialect: H2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>schema-generate</code> option is currently only recommended for simple applications, testing and demos and is not considered production-ready. The dialect set in configuration is the dialect that will be used to generate the schema.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_the_dialect">Setting the Dialect</h3>
<div class="paragraph">
<p>As seen in the YAML above you should also configure the dialect. Although queries are precomputed in the repository some cases (like pagination) still require the dialect to specified. The following table summarizes the supported dialects:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Supported JDBC Dialects</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Dialect</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/model/query/builder/sql/Dialect.html#H2">H2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The H2 database (typically used for in-memory testing)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/model/query/builder/sql/Dialect.html#MYSQL">MYSQL</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MySQL 5.5 or above</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/model/query/builder/sql/Dialect.html#POSTGRES">POSTGRES</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postgres 9.5 or above</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/model/query/builder/sql/Dialect.html#SQL_SERVER">SQL_SERVER</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL Server 2012 or above</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/model/query/builder/sql/Dialect.html#ORACLE">ORACLE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle 12c or above</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The dialect setting in configuration does <strong>not</strong> replace the need to ensure the correct dialect is set at the repository. If the dialect is H2 in configuration, the repository should have <code>@JdbcRepository(dialect = Dialect.H2)</code>. Because repositories are computed at compile time, the configuration value is not known at that time.
</td>
</tr>
</table>
</div>
</div>

<h2 id="jdbcRepositories"><a class="anchor" href="#jdbcRepositories"></a>8.1.3 JDBC Repositories</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcRepositories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As seen in the <a href="#jdbcQuickStart">Quick Start</a> JDBC repositories in Micronaut Data are defined as interfaces that are annotated with the <a href="../api/io/micronaut/data/jdbc/annotation/JdbcRepository.html">@JdbcRepository</a> annotation.</p>
</div>
<div class="paragraph">
<p>In multiple datasource scenario, the @io.micronaut.data.annotation.Repository annotation can be used to specify the datsource configuration to use. By default Micronaut Data will look for the default datasource.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Repository(value = "inventoryDataSource") <i class="conum" data-value="1"></i><b>(1)</b>
@JdbcRepository(dialect = Dialect.ORACLE) <i class="conum" data-value="2"></i><b>(2)</b>
public interface PhoneRepository extends CrudRepository&lt;Phone, Integer&gt; {
    Optional&lt;Phone&gt; findByAssetId(@NotNull Integer assetId);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>@Repository annotaiton, pointing to data source configuration 'inventoryDataSource'</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>@JdbcRepository with a specific dialect.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The entity to treat as the root entity for the purposes of querying is established either from the method signature or from the generic type parameter specified to the <a href="../api/io/micronaut/data/repository/GenericRepository.html">GenericRepository</a> interface.</p>
</div>
<div class="paragraph">
<p>If no root entity can be established then a compilation error will occur.</p>
</div>
<div class="paragraph">
<p>The same interfaces supported by the JPA implementation are supported by JDBC.</p>
</div>
<div class="paragraph">
<p>Note that because queries are computed at compilation time the <code>dialect</code> you use must be specified on the repository.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is recommended you test against your target dialect. The <a href="https://www.testcontainers.org">Test Containers</a> project is a great solution for this. If you must test against another dialect (like H2) then you can define a subinterface that <code>@Replaces</code> the repository with a different dialect for the scope of testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that in addition to interfaces you can also define repositories as abstract classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.data.jdbc.annotation.JdbcRepository;
import io.micronaut.data.jdbc.runtime.JdbcOperations;
import io.micronaut.data.model.query.builder.sql.Dialect;
import io.micronaut.data.repository.CrudRepository;

import javax.transaction.Transactional;
import java.sql.ResultSet;
import java.util.List;
import java.util.stream.Collectors;

@JdbcRepository(dialect = Dialect.H2)
public abstract class AbstractBookRepository implements CrudRepository&lt;Book, Long&gt; {

    private final JdbcOperations jdbcOperations;

    public AbstractBookRepository(JdbcOperations jdbcOperations) {
        this.jdbcOperations = jdbcOperations;
    }

    @Transactional
    public List&lt;Book&gt; findByTitle(String title) {
        String sql = "SELECT * FROM Book AS book WHERE book.title = ?";
        return jdbcOperations.prepareStatement(sql, statement -&gt; {
            statement.setString(1, title);
            ResultSet resultSet = statement.executeQuery();
            return jdbcOperations.entityStream(resultSet, Book.class).collect(Collectors.toList());
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.data.jdbc.annotation.JdbcRepository
import io.micronaut.data.jdbc.runtime.JdbcOperations
import io.micronaut.data.model.query.builder.sql.Dialect
import io.micronaut.data.repository.CrudRepository

import javax.transaction.Transactional
import java.sql.ResultSet
import java.util.List
import java.util.stream.Collectors

@JdbcRepository(dialect = Dialect.H2)
abstract class AbstractBookRepository implements CrudRepository&lt;Book, Long&gt; {

    private final JdbcOperations jdbcOperations

    AbstractBookRepository(JdbcOperations jdbcOperations) {
        this.jdbcOperations = jdbcOperations
    }

    @Transactional
    List&lt;Book&gt; findByTitle(String title) {
        String sql = "SELECT * FROM Book AS book WHERE book.title = ?"
        return jdbcOperations.prepareStatement(sql,  { statement -&gt;
            statement.setString(1, title)
            ResultSet resultSet = statement.executeQuery()
            return jdbcOperations.entityStream(resultSet, Book.class)
                    .collect(Collectors.toList())
        })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.Repository
import io.micronaut.data.jdbc.runtime.JdbcOperations
import io.micronaut.data.repository.CrudRepository
import java.util.stream.Collectors

import javax.transaction.Transactional
import kotlin.streams.toList

@Repository
abstract class AbstractBookRepository(private val jdbcOperations: JdbcOperations) : CrudRepository&lt;Book, Long&gt; {

    @Transactional
    fun findByTitle(title: String): List&lt;Book&gt; {
        val sql = "SELECT * FROM Book AS book WHERE book.title = ?"
        return jdbcOperations.prepareStatement(sql) { statement -&gt;
            statement.setString(1, title)
            val resultSet = statement.executeQuery()
            jdbcOperations.entityStream(resultSet, Book::class.java)
                    .toList()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the above example, using abstract classes can be useful as it allows you to combine custom code that performs your own SQL queries.</p>
</div>
<div class="paragraph">
<p>The example above uses the <a href="../api/io/micronaut/data/jdbc/runtime/JdbcOperations.html">JdbcOperations</a> interface which simplifies executing JDBC queries within the context of transactions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You could also inject whichever other tool you wish to use to handle more complex  queries, such as QueryDSL, JOOQ, Spring JdbcTemplate etc.
</td>
</tr>
</table>
</div>

<h2 id="sqlInserts"><a class="anchor" href="#sqlInserts"></a>8.1.3.1 Inserts and Updates</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcRepositories/sqlInserts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Unlike JPA/Hibernate, Micronaut Data JDBC is stateless and has no notion of a persistence session that requires state management.</p>
</div>
<div class="paragraph">
<p>Since there is no session, features like dirty checking are not supported. This has implications when defining repository methods for inserts and updates.</p>
</div>
<div class="paragraph">
<p>By default when saving an entity with a method like <code>save(MyEntity)</code> a SQL <code>INSERT</code> is always performed since Micronaut Data has no way to know whether the entity is associated to a particular session.</p>
</div>
<div class="paragraph">
<p>If you wish to update an entity you should instead either use <code>update(MyEntity)</code> or even better define an appropriate <code>update</code> method to update only the data you want to update, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">void update(@Id Long id, int pages);

void update(@Id Long id, String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">void update(@Id Long id, int pages);

void update(@Id Long id, String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun update(@Id id: Long?, pages: Int)

fun update(@Id id: Long?, title: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>By being explicit in defining the method as an update method Micronaut Data knows to execute an <code>UPDATE</code>.</p>
</div>

<h2 id="sqlMapping"><a class="anchor" href="#sqlMapping"></a>8.1.4 Mapping Entities</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned in the <a href="#jdbcQuickStart">Quick Start</a> section, if you need to customize how entities map to the table and column names of the database you can use JPA annotations to do so or Micronaut Datas own annotations in the <code>io.micronaut.data.annotation</code> package.</p>
</div>
<div class="paragraph">
<p>An important aspect of Micronaut Data JDBC is that regardless whether you use JPA annotations or Micronaut Data annotations the entity classes must be compiled with Micronaut Data.</p>
</div>
<div class="paragraph">
<p>This is because Micronaut Data pre-computes the persistence model (the relationships between entities, the class/property name to table/column name mappings) at compilation time, which is one of the reasons Micronaut Data JDBC can startup so fast.</p>
</div>
<div class="paragraph">
<p>An example of mapping with Micronaut Data annotations can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Data Annotation Mapping Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.data.tck.entities;

import io.micronaut.data.annotation.*;

import java.util.Set;
import java.util.UUID;

@MappedEntity
public class Country {

    @Id
    @AutoPopulated
    private UUID uuid;
    private String name;

    @Relation(value = Relation.Kind.ONE_TO_MANY, mappedBy = "country")
    private Set&lt;CountryRegion&gt; regions;

    public Country(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public UUID getUuid() {
        return uuid;
    }

    public void setUuid(UUID uuid) {
        this.uuid = uuid;
    }

    public Set&lt;CountryRegion&gt; getRegions() {
        return regions;
    }

    public void setRegions(Set&lt;CountryRegion&gt; regions) {
        this.regions = regions;
    }
}</code></pre>
</div>
</div>

<h2 id="sqlAnnotations"><a class="anchor" href="#sqlAnnotations"></a>8.1.4.1 SQL Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlAnnotations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following table summarizes the different annotations and what they enable. If you are familiar with and prefer the JPA annotations then feel free to skip to the next section:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Data Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Annotation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/AutoPopulated.html">@AutoPopulated</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meta annotation for a value that should be auto-populated by Micronaut Data (such as time stamps and UUIDs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/DateCreated.html">@DateCreated</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows assigning a data created value (such as a <code>java.time.Instant</code>) prior to an insert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/DateUpdated.html">@DateUpdated</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows assigning a last updated value (such as a <code>java.time.Instant</code>) prior to an insert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/GeneratedValue.html">@GeneratedValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that the property value is generated by the database and not included in inserts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/Id.html">@Id</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the ID of an entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/EmbeddedId.html">@EmbeddedId</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an embedded ID of an entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/MappedEntity.html">@MappedEntity</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the entity is mapped to the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/MappedProperty.html">@MappedProperty</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to customize the column name, definition and data type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/Relation.html">@Relation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to specify a relationship (one-to-one, one-to-many, etc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/data/annotation/Transient.html">@Transient</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to specify a property is transient</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the case of using JPA only a subset of annotations are supported including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Table</code></p>
</li>
<li>
<p><code>@Id</code></p>
</li>
<li>
<p><code>@Column</code></p>
</li>
<li>
<p><code>@Transient</code></p>
</li>
<li>
<p><code>@JoinTable</code></p>
</li>
<li>
<p><code>@OneToMany</code></p>
</li>
<li>
<p><code>@OneToOne</code></p>
</li>
<li>
<p><code>@ManyToOne</code></p>
</li>
<li>
<p><code>@ManyToMany</code></p>
</li>
<li>
<p><code>@Embedded</code></p>
</li>
<li>
<p><code>@Embeddable</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Again Micronaut Data JDBC is not an ORM, but instead a simple data mapper so many of the concepts in JPA simply don&#8217;t apply, however for users familiar with these annotations it is handy being able to use them.</p>
</div>

<h2 id="sqlIdGenerator"><a class="anchor" href="#sqlIdGenerator"></a>8.1.4.2 ID Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlIdGenerator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The default ID generation expects the database to populate a value for the ID such as an <code>IDENTITY</code> column.</p>
</div>
<div class="paragraph">
<p>You can remove the <code>@GeneratedValue</code> annotation and in this case the expectation is that you will assign an ID before calling <code>save()</code>.</p>
</div>
<div class="paragraph">
<p>If you wish to use sequences for the ID you should invoke the SQL that generates the sequence value and assign it prior to calling <code>save()</code>.</p>
</div>
<div class="paragraph">
<p>Automatically assigned UUIDs are also supported by adding a property annotated with <code>@Id</code> and <code>@AutoPopulated</code>.</p>
</div>

<h2 id="sqlCompositeId"><a class="anchor" href="#sqlCompositeId"></a>8.1.4.3 Composite Primary Keys</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlCompositeId.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can define a composite primary key using either JPA or Micronaut Data annotations.</p>
</div>
<div class="paragraph">
<p>A composite ID requires an additional class for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.Embeddable;
import java.util.Objects;

@Embeddable
public class ProjectId {
    private final int departmentId;
    private final int projectId;

    public ProjectId(int departmentId, int projectId) {
        this.departmentId = departmentId;
        this.projectId = projectId;
    }

    public int getDepartmentId() {
        return departmentId;
    }

    public int getProjectId() {
        return projectId;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) {
            return true;
        }
        if (o == null || getClass() != o.getClass()) {
            return false;
        }
        ProjectId projectId1 = (ProjectId) o;
        return departmentId == projectId1.departmentId &amp;&amp;
                projectId == projectId1.projectId;
    }

    @Override
    public int hashCode() {
        return Objects.hash(departmentId, projectId);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import groovy.transform.EqualsAndHashCode
import javax.persistence.Embeddable

@EqualsAndHashCode
@Embeddable
class ProjectId {
    final int departmentId
    final int projectId

    ProjectId(int departmentId, int projectId) {
        this.departmentId = departmentId
        this.projectId = projectId
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.Embeddable

@Embeddable
data class ProjectId(val departmentId: Int, val projectId: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended that the ID class be immutable and implement <code>equals</code>/<code>hashCode</code>.</p>
</div>
<div class="paragraph">
<p>You should then declare the <code>id</code> property of the entity with either JPA&#8217;s <code>@EmbeddedId</code> or <a href="../api/io/micronaut/data/annotation/EmbeddedId.html">@EmbeddedId</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.EmbeddedId;
import javax.persistence.Entity;

@Entity
public class Project {
    @EmbeddedId
    private ProjectId projectId;
    private String name;

    public Project(ProjectId projectId, String name) {
        this.projectId = projectId;
        this.name = name;
    }

    public ProjectId getProjectId() {
        return projectId;
    }

    public String getName() {
        return name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.EmbeddedId
import javax.persistence.Entity

@Entity
class Project {
    @EmbeddedId
    private ProjectId projectId
    private String name

    Project(ProjectId projectId, String name) {
        this.projectId = projectId
        this.name = name
    }

    ProjectId getProjectId() {
        return projectId
    }

    String getName() {
        return name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.EmbeddedId
import javax.persistence.Entity

@Entity
class Project(
    @EmbeddedId val projectId: ProjectId,
    val name: String
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To alter the column mappings for the ID you use <code>@Column</code> in the <code>ProjectId</code> class
</td>
</tr>
</table>
</div>

<h2 id="sqlConstructorArguments"><a class="anchor" href="#sqlConstructorArguments"></a>8.1.4.4 Constructor Arguments</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlConstructorArguments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data JDBC also allows the definition of immutable objects using constructor arguments instead of getters/setters. If you define multiple constructors then the one used to create the object from the database should be annotated with <code>io.micronaut.core.annotation.Creator</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.core.annotation.Creator;

import javax.persistence.*;

@Entity
public class Manufacturer {
    @Id
    @GeneratedValue
    private Long id;
    private String name;

    @Creator
    public Manufacturer(String name) {
        this.name = name;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.core.annotation.Creator

import javax.persistence.*

@Entity
class Manufacturer {
    @Id
    @GeneratedValue
    Long id
    final String name

    @Creator
    Manufacturer(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.*

@Entity
data class Manufacturer(
    @Id
    @GeneratedValue
    var id: Long?,
    val name: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above, the <code>ID</code> of the object should however include a setter since this has to be assigned from the database generated value.</p>
</div>

<h2 id="sqlNaming"><a class="anchor" href="#sqlNaming"></a>8.1.4.5 SQL Naming Strategies</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlNaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The default naming strategy when converting camel case class and property names to database tables and columns is to use underscore separated lower case. In other words <code>FooBar</code> becomes <code>foo_bar</code>.</p>
</div>
<div class="paragraph">
<p>If this is not satisfactory then you can customize this by setting the <code>namingStrategy</code> member of the <a href="../api/io/micronaut/data/annotation/MappedEntity.html">@MappedEntity</a> annotation on the entity:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Data Naming Strategy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MappedEntity(namingStrategy = NamingStrategies.Raw.class)
public class CountryRegion {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Few important things to note. Since Micronaut Data pre-computes the table and column name mappings at compilation time the specified <a href="../api/io/micronaut/data/model/naming/NamingStrategy.html">NamingStrategy</a> implementation must be on the annotation processor classpath (<code>annotationProcessor</code> scope for Java or <code>kapt</code> for Kotlin).</p>
</div>
<div class="paragraph">
<p>In addition if you don&#8217;t want to repeat the above annotation definition on every entity it is handy to define a meta-annotation where the above annotation definition is applied to another annotation that you add to your class.</p>
</div>
<div class="sect3">
<h4 id="_escaping_table_column_name_identifiers">Escaping Table/Column Name Identifiers</h4>
<div class="paragraph">
<p>In some cases it may be necessary to escape table and/or column names if characters are used within the names that are invalid without the presence of escaping.</p>
</div>
<div class="paragraph">
<p>In this case you should set the <code>escape</code> member of the <a href="../api/io/micronaut/data/annotation/MappedEntity.html">@MappedEntity</a> annotation to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MappedEntity(escape=true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut Data will generate SQL statements that escape table and column names within queries using the escape character that is appropriate for the configured SQL dialect.</p>
</div>
</div>

<h2 id="sqlAssociations"><a class="anchor" href="#sqlAssociations"></a>8.1.4.6 Association Fetching</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlAssociations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data is a simple data mapper, hence it will not fetch any associations for you using techniques like lazy loading of entity proxies for single-ended associations.</p>
</div>
<div class="paragraph">
<p>You must instead specify ahead of time what data you want to fetch. You cannot map an association as being eager or lazy. The reason for this design choice is simple, even in the JPA world accessing lazy associations or lazy initialization collections is considered bad practice due to the N+1 query issue and the recommendation is always to write an optimized join query.</p>
</div>
<div class="paragraph">
<p>Micronaut Data JDBC takes this a step further by simply not supporting those features considered bad practice anyway. However, it does impact how you may model an association. For example, if you define an association in a constructor argument such as the following entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.*;

@Entity
public class Product {

    @Id
    @GeneratedValue
    private Long id;
    private String name;
    @ManyToOne
    private Manufacturer manufacturer;

    public Product(String name, Manufacturer manufacturer) {
        this.name = name;
        this.manufacturer = manufacturer;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public Manufacturer getManufacturer() {
        return manufacturer;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.*

@Entity
class Product {

    @Id
    @GeneratedValue
    Long id
    private String name
    @ManyToOne
    private Manufacturer manufacturer

    Product(String name, Manufacturer manufacturer) {
        this.name = name
        this.manufacturer = manufacturer
    }

    String getName() {
        return name
    }

    Manufacturer getManufacturer() {
        return manufacturer
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.*

@Entity
data class Product(
    @Id
    @GeneratedValue
    var id: Long?,
    var name: String,
    @ManyToOne
    var manufacturer: Manufacturer?
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then attempt to read the <code>Product</code> entity back without specifying a join an exception will occur since the <code>manufacturer</code> association is not <code>Nullable</code>.</p>
</div>
<div class="paragraph">
<p>There are few ways around this, one way is to declare at the repository level to always fetch <code>manufacturer</code>, another is declare the <code>@Nullable</code> annotation on the <code>manufacturer</code> argument to allow it to be declared <code>null</code> (or in Kotlin add <code>?</code> to the end of the constructor argument name). Which approach you choose is dependent on the design of the application.</p>
</div>
<div class="paragraph">
<p>The following section provides more coverage on handling joins.</p>
</div>

<h2 id="columnTransformer"><a class="anchor" href="#columnTransformer"></a>8.1.4.7 Using @ColumnTransformer</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/columnTransformer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Inspired by the similar annotation in Hibernate, you can apply a transformation when either reading or writing a column from or to the database using the <a href="../api/io/micronaut/data/jdbc/annotation/ColumnTransformer.html">@ColumnTransformer</a> annotation.</p>
</div>
<div class="paragraph">
<p>This feature can be used to encrypt/decrypt values or invoke any arbitrary database function. To define a read transformation use the <code>read</code> member. For example:</p>
</div>
<div class="listingblock">
<div class="title">Applying a read transformation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ColumnTransformer(read = "UPPER(name)")
private String name;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may need to use the alias before the column name which is the table name followed by underscore. Example: <code>project_.name</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To apply a write transformation you should use the <code>write</code> member and include exactly one <code>?</code> placeholder:</p>
</div>
<div class="listingblock">
<div class="title">Apply a write transformation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ColumnTransformer(write = "UPPER(?)")
private String name;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this any place any <code>INSERT</code> or <code>UPDATE</code> statement generated will include the above <code>write</code> entry.</p>
</div>

<h2 id="sqlJsonType"><a class="anchor" href="#sqlJsonType"></a>8.1.4.8 JSON Column Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/sqlMapping/sqlJsonType.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can declare a field of a class as a JSON type using the <a href="../api/io/micronaut/data/annotation/TypeDef.html">@TypeDef</a> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeDef(type = DataType.JSON)
private Map&lt;String, String&gt; data;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will map to a column called <code>data</code>. Depending on the underling database the column type will be adjusted. For example for Postgres which features native JSON support the column type will be <code>JSONB</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To allow JSON to be serialized and deserialized in entity properties you must have Jackson and the <code>micronaut-runtime</code> module your classpath.
</td>
</tr>
</table>
</div>

<h2 id="jdbcJoinQueries"><a class="anchor" href="#jdbcJoinQueries"></a>8.1.5 JDBC Join Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcJoinQueries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As discussed in the previous section, Micronaut Data JDBC doesn&#8217;t support associations in the traditional ORM sense. There is no lazy loading or support for proxies.</p>
</div>
<div class="paragraph">
<p>Consider a <code>Product</code> entity from the previous section that has an association to a <code>Manufacturer</code> entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.core.annotation.Creator;

import javax.persistence.*;

@Entity
public class Manufacturer {
    @Id
    @GeneratedValue
    private Long id;
    private String name;

    @Creator
    public Manufacturer(String name) {
        this.name = name;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import io.micronaut.core.annotation.Creator

import javax.persistence.*

@Entity
class Manufacturer {
    @Id
    @GeneratedValue
    Long id
    final String name

    @Creator
    Manufacturer(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.*

@Entity
data class Manufacturer(
    @Id
    @GeneratedValue
    var id: Long?,
    val name: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Say you query for <code>Product</code> instances, what happens is that by default Micronaut Data JDBC will only query for and fetch the simple properties. In the case of single ended associations like the above Micronaut Data will only retrieve the ID and assign it if is possible (In the case of entities that require constructor arguments this is not even possible).</p>
</div>
<div class="paragraph">
<p>If you need to fetch the association too then you can use the <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation on your repository interface to specify that a <code>INNER JOIN</code> (or whichever join types is more appropriate) should be executed to retrieve the associated <code>Manufacturer</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@JdbcRepository(dialect = Dialect.H2)
public interface ProductRepository extends CrudRepository&lt;Product, Long&gt; {
    @Join(value = "manufacturer", type = Join.Type.FETCH) <b class="conum">(1)</b>
    List&lt;Product&gt; list();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@JdbcRepository(dialect = Dialect.H2)
public interface ProductRepository extends CrudRepository&lt;Product, Long&gt; {
    @Join(value = "manufacturer", type = Join.Type.FETCH) <b class="conum">(1)</b>
    List&lt;Product&gt; list();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@JdbcRepository(dialect = Dialect.H2)
interface ProductRepository : CrudRepository&lt;Product, Long&gt; {
    @Join(value = "manufacturer", type = Join.Type.FETCH) <b class="conum">(1)</b>
    fun list(): List&lt;Product&gt;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> is used to indicate a <code>INNER JOIN</code> clause should be included.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation is repeatable and hence can be specified multiple time for different associations. In addition, the <code>type</code> member of the annotation can be used to specify the join type, for example <code>LEFT</code>, <code>INNER</code> or <code>RIGHT</code>.</p>
</div>
<div class="paragraph">
<p>Finally, by default Micronaut Data will generate aliases to use for selecting columns in joins and querying. However, if at any point you experience a conflict you can specify an alias for a particular join using the <code>alias</code> member of the <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Some databases like Oracle limit the length of alias names in SQL queries so another reason you may want to set custom aliases is to avoid exceeding the alias name length restriction in Oracle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to do anything more complex than the join options Micronaut Data has to offer then you may need a native query.</p>
</div>

<h2 id="jdbcDataTypes"><a class="anchor" href="#jdbcDataTypes"></a>8.1.6 JDBC Data Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcDataTypes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data JDBC supports most common Java data types. The following properties types are supported by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All primitive types and their wrappers (<code>int</code>, <code>java.lang.Integer</code> etc.)</p>
</li>
<li>
<p><code>CharSequence</code>, <code>String</code> etc.</p>
</li>
<li>
<p>Date types like <code>java.util.Date</code>, <code>java.time.LocalDate</code> etc.</p>
</li>
<li>
<p>Enum types (by name only)</p>
</li>
<li>
<p>Entity References. In the case of <code>@ManyToOne</code> the foreign key column name is computed to be the name of the association plus a suffix of <code>_id</code>. You can alter this with either <code>@Column(name="..")</code> or by providing a <code>NamingStrategy.mappedName(..)</code> implementation.</p>
</li>
<li>
<p>Collections of Entity. In the case of <code>@OneToMany</code> and if <code>mappedBy</code> is specified then it is expected that the inverse property exists defining the column, otherwise a join table mapping is created.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you wish to define a custom data type then you can do so by defining a class that is annotated with <a href="../api/io/micronaut/data/annotation/TypeDef.html">@TypeDef</a>.</p>
</div>
<div class="paragraph">
<p>Consider the following example entity:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import javax.persistence.*;

@Entity
public class Sale {

    @ManyToOne
    private final Product product;
    private final Quantity quantity;

    @Id
    @GeneratedValue
    private Long id;

    public Sale(Product product, Quantity quantity) {
        this.product = product;
        this.quantity = quantity;
    }

    public Product getProduct() {
        return product;
    }

    public Quantity getQuantity() {
        return quantity;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import javax.persistence.Id
import javax.persistence.Entity
import javax.persistence.ManyToOne
import javax.persistence.GeneratedValue

@Entity
class Sale {

    @ManyToOne
    final Product product

    final Quantity quantity

    @Id
    @GeneratedValue
    Long id

    Sale(Product product, Quantity quantity) {
        this.product = product
        this.quantity = quantity
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import javax.persistence.*

@Entity
data class Sale(
    @Id
    @GeneratedValue
    var id: Long?,
    @ManyToOne
    val product: Product,
    val quantity: Quantity
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Sale</code> class has a reference to a type <code>Quantity</code>. The <code>Quantity</code> type is defined as:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.data.annotation.TypeDef;
import io.micronaut.data.model.DataType;

@TypeDef(type = DataType.INTEGER)
public class Quantity {
    private final int amount;

    private Quantity(int amount) {
        this.amount = amount;
    }

    public int getAmount() {
        return amount;
    }

    public static Quantity valueOf(int amount) {
        return new Quantity(amount);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import groovy.transform.Immutable
import io.micronaut.data.annotation.TypeDef
import io.micronaut.data.model.DataType

@TypeDef(type = DataType.INTEGER)
@Immutable
class Quantity {
    int amount
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.data.annotation.TypeDef
import io.micronaut.data.model.DataType

@TypeDef(type = DataType.INTEGER)
data class Quantity(val amount: Int)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see <code>@TypeDef</code> is used to define the <code>Quantity</code> type as an <code>INTEGER</code> using the <a href="../api/io/micronaut/data/model/DataType.html">DataType</a> enum.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you cannot declare <code>@TypeDef</code> directly on the type then you can declare it on the field where the type is used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The last step is to add custom type conversion so that Micronaut Data knows how to read and write the type from an <code>Integer</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright 2017-2020 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package example;

import io.micronaut.context.annotation.Factory;
import io.micronaut.core.convert.TypeConverter;

import javax.inject.Singleton;
import java.util.Optional;

@Factory <b class="conum">(1)</b>
public class QuantityConverters {

    @Singleton <b class="conum">(2)</b>
    TypeConverter&lt;Quantity, Integer&gt; quantityIntegerTypeConverter() {
        return (object, targetType, context) -&gt; Optional.of(object.getAmount());
    }

    @Singleton <b class="conum">(3)</b>
    TypeConverter&lt;Integer, Quantity&gt; integerQuantityTypeConverter() {
        return (object, targetType, context) -&gt; Optional.of(Quantity.valueOf(object));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package example

import groovy.transform.CompileStatic
import io.micronaut.context.annotation.Factory
import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.TypeConverter

import javax.inject.Singleton

@Factory <b class="conum">(1)</b>
@CompileStatic
class QuantityConverters {

    @Singleton <b class="conum">(2)</b>
    TypeConverter&lt;Quantity, Integer&gt; quantityIntegerTypeConverter() {
        return { Quantity quantity, Class targetType, ConversionContext context -&gt;
            Optional.of(quantity.amount)
        } as TypeConverter&lt;Quantity, Integer&gt;
    }

    @Singleton <b class="conum">(3)</b>
    TypeConverter&lt;Integer, Quantity&gt; integerQuantityTypeConverter() {
        return { Integer integer, Class targetType, ConversionContext context -&gt;
            Optional.of(new Quantity(integer))
        } as TypeConverter&lt;Integer, Quantity&gt;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package example

import io.micronaut.context.annotation.Factory
import io.micronaut.core.convert.TypeConverter

import javax.inject.Singleton
import java.util.Optional

@Factory <b class="conum">(1)</b>
class QuantityConverters {

    @Singleton <b class="conum">(2)</b>
    fun quantityIntegerTypeConverter(): TypeConverter&lt;Quantity, Int&gt; {
        return TypeConverter { quantity, targetType, context -&gt; Optional.of&lt;Int&gt;(quantity.amount) }
    }

    @Singleton <b class="conum">(3)</b>
    fun integerQuantityTypeConverter(): TypeConverter&lt;Int, Quantity&gt; {
        return TypeConverter { integer, targetType, context -&gt; Optional.of&lt;Quantity&gt;(Quantity(integer)) }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>@Factory</code> bean is created to define the converters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A converter from <code>Quantity</code> to <code>Integer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A converter from <code>Integer</code> to <code>Quantity</code></td>
</tr>
</table>
</div>

<h2 id="jdbcNativeQueries"><a class="anchor" href="#jdbcNativeQueries"></a>8.1.7 Explicit JDBC Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/sql/jdbc/jdbcNativeQueries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When using Micronaut Data with JDBC you can execute native SQL queries using the <a href="../api/io/micronaut/data/annotation/Query.html">@Query</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Query("select * from book b where b.title like :title limit 5")
List&lt;Book&gt; findBooks(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Query("select * from book b where b.title like :title limit 5")
List&lt;Book&gt; findBooks(String title);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Query("select * from book b where b.title like :title limit 5")
fun findBooks(title: String): List&lt;Book&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will execute the raw SQL against the database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For <a href="#pagination">Pagination</a> queries that return a <a href="../api/io/micronaut/data/model/Page.html">Page</a> you also need to specify a native <code>countQuery</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_explicit_queries_and_joins">Explicit Queries and Joins</h3>
<div class="paragraph">
<p>When writing an explicit SQL query if you specify any joins within the query you may want the resulting data bound to the returned entity. Micronaut Data will not automatically do this, instead you need to specify the associated <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Query("SELECT *, m_.name as m_name, m_.id as m_id FROM product p INNER JOIN manufacturer m_ ON p.manufacturer_id = m_.id WHERE p.name like :name limit 5")
    @Join(value = "manufacturer", alias = "m_")
    List&lt;Product&gt; searchProducts(String name);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Query("""SELECT *, m_.name as m_name, m_.id as m_id
              FROM product p
              INNER JOIN manufacturer m_ ON p.manufacturer_id = m_.id
              WHERE p.name like :name limit 5""")
    @Join(value = "manufacturer", alias = "m_")
    List&lt;Product&gt; searchProducts(String name);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Query("""SELECT *, m_.name as m_name, m_.id as m_id
                    FROM product p
                    INNER JOIN manufacturer m_ ON p.manufacturer_id = m_.id
                    WHERE p.name like :name limit 5""")
    @Join(value = "manufacturer", alias = "m_")
    fun searchProducts(name: String): List&lt;Product&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the query uses an alias called <code>m_</code> to query the <code>manufacturer</code> table via an <code>INNER JOIN</code>. Since the returned <code>Product</code> entity features a <code>manufacturer</code> association it may be nice to materialize this object as well. The <code>alias</code> member of the <a href="../api/io/micronaut/data/annotation/Join.html">@Join</a> annotation is used to specify which alias to materialize the <code>Manufacturer</code> instance from.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is necessary to use the "logical name" of the field in the <code>@Join</code> (the name used in the <code>@Entity</code> class) and not the name used in the native query itself. In the previous example, if the name in the class were <code>myManufacturer</code>, then you would need to use <code>Join(value = "myManufacturer", alias = "m_")</code> without modifying anything on the native sql query.
</td>
</tr>
</table>
</div>
</div>

<h1 id="graal"><a class="anchor" href="#graal"></a>9 Going Native with GraalVM</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data supports GraalVM native images for both the JPA and JDBC implementations.</p>
</div>
<div class="paragraph">
<p>The currently supported databases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>H2</p>
</li>
<li>
<p>Postgres</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>MariaDB</p>
</li>
<li>
<p>MS SQLServer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut Data will automatically detect the driver and configure the driver correctly for each database as appropriate.</p>
</div>

<h1 id="spring"><a class="anchor" href="#spring"></a>10 Spring Data Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/spring.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data features general Spring support that is provided through the <code>micronaut-data-spring</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-spring:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-spring&lt;/artifactId&gt;
    &lt;version&gt;1.1.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>In addition to this dependency you will need either <code>spring-orm</code> (for Hibernate) or <code>spring-jdbc</code> (for JDBC) on your classpath to enable support for Spring-based transaction management:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"org.springframework:spring-orm:5.2.0.RELEASE")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
    &lt;version&gt;5.2.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You can then compile existing Spring Data repository interfaces and use Spring annotations such as <code>org.springframework.transaction.annotation.Transactional</code> in your application.</p>
</div>
<div class="paragraph">
<p>You can extend from existing Spring Data interfaces such as <code>CrudRepository</code>, <code>PagingAndSortingRepository</code> and so on.</p>
</div>
<div class="paragraph">
<p>The following Spring Data types are also supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html">Pageable</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Sort.html">Sort</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Slice.html">Page</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/PageRequest.html">PageRequest</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html">CrudRepository</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/PagingAndSortingRepository.html">PagingAndSortingRepository</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_spring_data_jpa_specification_support">Spring Data JPA Specification Support</h3>
<div class="paragraph">
<p>To obtain additional support for <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications">Spring Data JPA Specifications</a> when using Hibernate and JPA you should add the following dependency to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-spring-jpa:1.1.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-spring-jpa&lt;/artifactId&gt;
    &lt;version&gt;1.1.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You can then implement the <code>JpaSpecificationExecutor</code> (the generic argument to the inteface should be a domain class) interface as per the <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications">Spring Data JPA documentation</a>.</p>
</div>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>